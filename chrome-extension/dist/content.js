(()=>{"use strict";var e={45:(e,n,t)=>{t.d(n,{A:()=>l});var o=t(601),r=t.n(o),i=t(314),s=t.n(i)()(r());s.push([e.id,'.reply-guy-overlay {\n  position: fixed;\n  z-index: 10000;\n  background: white;\n  border-radius: 16px;\n  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.12);\n  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;\n  overflow: hidden;\n  animation: slideIn 0.3s ease-out;\n  display: flex;\n  flex-direction: column;\n  max-height: 80vh; /* Limit to 80% of viewport height */\n}\n\n@keyframes slideIn {\n  from {\n    opacity: 0;\n    transform: translateY(-20px);\n  }\n  to {\n    opacity: 1;\n    transform: translateY(0);\n  }\n}\n\n.reply-guy-header {\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n  padding: 16px 20px;\n  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\n  color: white;\n  flex-shrink: 0; /* Prevent header from shrinking */\n}\n\n.reply-guy-title {\n  display: flex;\n  align-items: center;\n  font-size: 18px;\n  font-weight: 600;\n  gap: 10px;\n}\n\n.reply-guy-logo-icon {\n  width: 28px;\n  height: 28px;\n  filter: brightness(0) invert(1);\n}\n\n.reply-guy-close {\n  width: 32px;\n  height: 32px;\n  border: none;\n  background: rgba(255, 255, 255, 0.2);\n  color: white;\n  border-radius: 8px;\n  cursor: pointer;\n  font-size: 24px;\n  line-height: 1;\n  transition: all 0.2s;\n}\n\n.reply-guy-close:hover {\n  background: rgba(255, 255, 255, 0.3);\n  transform: scale(1.05);\n}\n\n.reply-guy-content {\n  padding: 20px;\n  overflow-y: auto;\n  flex: 1;\n  max-height: calc(80vh - 80px); /* Account for header height */\n}\n\n/* V4 Compact Design Grid Styles */\n.reply-guy-grid-3-col {\n  display: grid;\n  grid-template-columns: repeat(3, 1fr);\n  gap: 12px;\n  margin-bottom: 16px;\n}\n\n.reply-guy-features-grid {\n  display: grid;\n  grid-template-columns: repeat(2, 1fr);\n  gap: 10px;\n  margin-bottom: 16px;\n}\n\n.reply-guy-footer {\n  padding: 16px 20px;\n  border-top: 1px solid #e9ecef;\n  background: #f8f9fa;\n  flex-shrink: 0;\n}\n\n.reply-guy-usage-stats {\n  display: flex;\n  justify-content: space-between;\n  margin-top: 12px;\n  font-size: 13px;\n  color: #6c757d;\n}\n\n.reply-guy-usage-item {\n  display: flex;\n  align-items: center;\n  gap: 4px;\n}\n\n.reply-guy-usage-value {\n  font-weight: 600;\n  color: #495057;\n}\n\n.reply-guy-save-defaults-checkbox {\n  margin-top: 12px;\n}\n\n.reply-guy-content-scroll {\n  overflow-y: auto;\n  flex: 1;\n  padding: 20px;\n  min-height: 0;\n  max-height: calc(80vh - 180px); /* Account for header and footer */\n}\n\n/* Tweet Preview Section */\n\n.reply-guy-tweet-preview {\n  padding: 16px;\n  font-size: 14px;\n  line-height: 1.5;\n  color: #6c757d;\n  max-height: 150px;\n  overflow-y: auto;\n}\n\n.reply-guy-row {\n  display: flex;\n  gap: 12px;\n  margin-bottom: 20px;\n}\n\n.reply-guy-half {\n  flex: 1;\n}\n\n.reply-guy-select {\n  width: 100%;\n  padding: 8px 10px;\n  border: 2px solid #e9ecef;\n  border-radius: 8px;\n  font-size: 13px;\n  color: #212529; /* Explicitly set text color */\n  transition: all 0.2s;\n  font-family: inherit;\n  background: white;\n  cursor: pointer;\n  -webkit-appearance: none; /* Remove default styling */\n}\n\n.reply-guy-select option {\n  color: #212529; /* Ensure option text is visible */\n  background: white;\n}\n\n.reply-guy-select:focus {\n  outline: none;\n  border-color: #667eea;\n  box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);\n}\n\n.reply-guy-main-section {\n  margin-bottom: 16px;\n}\n\n/* Form Elements */\n.reply-guy-option-group {\n  margin-bottom: 12px;\n}\n\n/* Compact spacing for grid items */\n.reply-guy-grid-3-col .reply-guy-option-group,\n.reply-guy-features-grid .reply-guy-option-group {\n  margin-bottom: 0;\n}\n\n.reply-guy-option-label {\n  display: block;\n  font-size: 12px;\n  font-weight: 600;\n  color: #6c757d;\n  text-transform: uppercase;\n  margin-bottom: 8px;\n  letter-spacing: 0.5px;\n}\n\n.reply-guy-label-with-action {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  margin-bottom: 8px;\n}\n\n\n.reply-guy-text-input,\n.reply-guy-idea-input {\n  width: 100%;\n  padding: 10px 12px;\n  border: 2px solid #e9ecef;\n  border-radius: 8px;\n  font-size: 14px;\n  transition: all 0.2s;\n  font-family: inherit;\n}\n\n.reply-guy-text-input:focus,\n.reply-guy-idea-input:focus {\n  outline: none;\n  border-color: #667eea;\n  box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);\n}\n\n.reply-guy-idea-input {\n  resize: vertical;\n  min-height: 60px;\n}\n\n.reply-guy-idea-input.error {\n  border-color: #dc3545;\n}\n\n.reply-guy-char-count {\n  text-align: right;\n  font-size: 12px;\n  color: #6c757d;\n  margin-top: 4px;\n}\n\n.reply-guy-suggest-btn {\n  display: flex;\n  align-items: center;\n  gap: 4px;\n  padding: 4px 12px;\n  background: #f8f9fa;\n  border: 1px solid #e9ecef;\n  border-radius: 6px;\n  font-size: 12px;\n  color: #667eea;\n  cursor: pointer;\n  transition: all 0.2s;\n}\n\n.reply-guy-suggest-btn:hover {\n  background: #e9ecef;\n  border-color: #667eea;\n}\n\n/* Radio and Checkbox */\n.reply-guy-length-options,\n.reply-guy-meme-mode {\n  display: flex;\n  gap: 12px;\n  flex-wrap: wrap;\n}\n\n.reply-guy-radio,\n.reply-guy-checkbox {\n  display: flex;\n  align-items: center;\n  gap: 6px;\n  cursor: pointer;\n  font-size: 14px;\n  color: #495057;\n}\n\n.reply-guy-radio input[type="radio"],\n.reply-guy-checkbox input[type="checkbox"] {\n  cursor: pointer;\n}\n\n.reply-guy-radio input[type="radio"]:disabled + span,\n.reply-guy-checkbox input[type="checkbox"]:disabled + span {\n  opacity: 0.5;\n  cursor: not-allowed;\n}\n\n.reply-guy-option-hint {\n  font-size: 11px;\n  color: #868e96;\n  margin-top: 4px;\n  margin-left: 24px;\n}\n\n/* Save Defaults */\n.reply-guy-save-defaults {\n  margin: 16px 0;\n  padding: 12px 16px;\n  background: #f8f9fa;\n  border-radius: 8px;\n}\n\n.reply-guy-checkbox {\n  display: flex;\n  align-items: center;\n  cursor: pointer;\n  font-size: 14px;\n  color: #495057;\n}\n\n.reply-guy-checkbox input {\n  margin-right: 8px;\n}\n\n/* Action Buttons */\n.reply-guy-actions {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  margin-top: 24px;\n  padding-top: 20px;\n  border-top: 1px solid #e9ecef;\n}\n\n.reply-guy-generate-btn {\n  width: 100%;\n  padding: 14px 24px;\n  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\n  color: white;\n  border: none;\n  border-radius: 10px;\n  font-size: 16px;\n  font-weight: 600;\n  cursor: pointer;\n  transition: all 0.3s;\n  box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);\n}\n\n.reply-guy-generate-btn:hover {\n  transform: translateY(-2px);\n  box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);\n}\n\n.reply-guy-generate-btn:active {\n  transform: translateY(0);\n}\n\n.reply-guy-usage {\n  margin-left: 16px;\n  font-size: 13px;\n  color: #6c757d;\n  white-space: nowrap;\n  display: flex;\n  flex-direction: column;\n  align-items: flex-end;\n  gap: 2px;\n}\n\n.reply-guy-usage-remaining {\n  font-weight: 600;\n  color: #495057;\n}\n\n.reply-guy-usage-detail {\n  font-size: 11px;\n  color: #adb5bd;\n}\n\n.reply-guy-daily-goal {\n  display: flex;\n  align-items: center;\n  gap: 6px;\n  margin-top: 8px;\n  padding: 8px 12px;\n  background: #f8f9fa;\n  border-radius: 8px;\n  font-size: 13px;\n  color: #495057;\n}\n\n.reply-guy-daily-icon {\n  font-size: 16px;\n}\n\n.reply-guy-daily-text {\n  font-weight: 500;\n}\n\n/* Research suggestions */\n.reply-guy-suggestion-label {\n  font-size: 12px;\n  font-weight: 600;\n  color: #6c757d;\n  margin-bottom: 6px;\n}\n\n.reply-guy-suggestion-chips {\n  display: flex;\n  flex-wrap: wrap;\n  gap: 6px;\n}\n\n.reply-guy-suggestion-chip {\n  padding: 6px 12px;\n  background: #f8f9fa;\n  border: 1px solid #e9ecef;\n  border-radius: 16px;\n  font-size: 12px;\n  color: #495057;\n  cursor: pointer;\n  transition: all 0.2s;\n}\n\n.reply-guy-suggestion-chip:hover {\n  background: #e9ecef;\n  border-color: #667eea;\n  color: #667eea;\n}\n\n/* Meme styles */\n.reply-guy-meme-usage {\n  font-size: 11px;\n  color: #6c757d;\n  margin-left: 8px;\n}\n\n.reply-guy-meme-info {\n  margin-top: 8px;\n  padding: 8px;\n  background: #f8f9fa;\n  border-radius: 6px;\n  font-size: 12px;\n  color: #495057;\n}\n\n.reply-guy-meme-info p {\n  margin: 0;\n}\n\n.reply-guy-meme-info strong {\n  font-weight: 600;\n}\n\n/* Responsive adjustments for smaller overlays */\n@media (max-width: 480px) {\n  .reply-guy-grid-3-col {\n    grid-template-columns: 1fr;\n    gap: 8px;\n  }\n  \n  .reply-guy-features-grid {\n    grid-template-columns: 1fr;\n    gap: 8px;\n  }\n  \n  .reply-guy-usage-stats {\n    flex-direction: column;\n    gap: 8px;\n  }\n}\n\n/* Spinner for loading */\n.reply-guy-spinner-small {\n  animation: spin 1s linear infinite;\n  display: inline-block;\n  vertical-align: middle;\n}\n\n/* Loading States */\n.reply-guy-loading {\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  justify-content: center;\n  padding: 60px;\n  gap: 16px;\n}\n\n.reply-guy-loading img {\n  animation: pulse 2s ease-in-out infinite;\n}\n\n@keyframes pulse {\n  0%, 100% {\n    transform: scale(1);\n    opacity: 1;\n  }\n  50% {\n    transform: scale(1.05);\n    opacity: 0.8;\n  }\n}\n\n.reply-guy-spinner {\n  width: 40px;\n  height: 40px;\n  border: 3px solid #f3f3f3;\n  border-top: 3px solid #667eea;\n  border-radius: 50%;\n  animation: spin 1s linear infinite;\n}\n\n@keyframes spin {\n  0% { transform: rotate(0deg); }\n  100% { transform: rotate(360deg); }\n}\n\n/* Loading dots animation */\n.reply-guy-loading-text {\n  color: #666;\n  font-size: 16px;\n  display: flex;\n  align-items: center;\n  gap: 4px;\n}\n\n.reply-guy-loading-dots {\n  display: inline-flex;\n  gap: 3px;\n}\n\n.reply-guy-loading-dot {\n  width: 6px;\n  height: 6px;\n  background: #667eea;\n  border-radius: 50%;\n  display: inline-block;\n  animation: loadingDot 1.4s infinite ease-in-out both;\n}\n\n.reply-guy-loading-dot:nth-child(1) {\n  animation-delay: -0.32s;\n}\n\n.reply-guy-loading-dot:nth-child(2) {\n  animation-delay: -0.16s;\n}\n\n@keyframes loadingDot {\n  0%, 80%, 100% {\n    transform: scale(0.8);\n    opacity: 0.5;\n  }\n  40% {\n    transform: scale(1.2);\n    opacity: 1;\n  }\n}\n\n/* Error State */\n.reply-guy-error {\n  padding: 20px;\n  text-align: center;\n  color: #dc3545;\n  background: #f8d7da;\n  border: 1px solid #f5c6cb;\n  border-radius: 8px;\n  margin: 16px;\n}\n\n/* Result display specific styles */\n.reply-guy-overlay {\n  display: flex !important;\n  flex-direction: column !important;\n  max-height: 80vh !important;\n}\n\n.reply-guy-content-scroll {\n  overflow-y: auto;\n  flex: 1;\n  padding: 20px;\n  min-height: 0; /* Important for Firefox */\n}\n\n.reply-guy-reply-text {\n  background: #f8f9fa;\n  border: 2px solid #e9ecef;\n  border-radius: 12px;\n  padding: 16px;\n  font-size: 15px;\n  line-height: 1.5;\n  color: #212529;\n  margin-bottom: 16px;\n}\n\n.reply-guy-meme-preview {\n  margin-bottom: 16px;\n  text-align: center;\n}\n\n.reply-guy-meme-preview img {\n  width: 100%;\n  max-width: 300px;\n  max-height: 300px;\n  height: auto;\n  object-fit: contain;\n  border-radius: 12px;\n  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);\n}\n\n.reply-guy-result-footer {\n  flex-shrink: 0;\n  padding: 0 20px 20px;\n  border-top: 1px solid #e9ecef;\n  background: white;\n}\n\n.reply-guy-result-actions {\n  display: flex;\n  gap: 12px;\n  padding-top: 16px;\n  justify-content: center;\n}\n\n.reply-guy-copy-btn, .reply-guy-edit-btn {\n  padding: 14px 24px;\n  border: none;\n  border-radius: 10px;\n  font-size: 15px;\n  font-weight: 600;\n  cursor: pointer;\n  transition: all 0.2s;\n  min-width: 140px;\n}\n\n.reply-guy-copy-btn {\n  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\n  color: white;\n  box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);\n}\n\n.reply-guy-copy-btn:hover {\n  transform: translateY(-1px);\n  box-shadow: 0 6px 16px rgba(102, 126, 234, 0.4);\n}\n\n.reply-guy-copy-btn.copied {\n  background: linear-gradient(135deg, #28a745 0%, #20c997 100%);\n}\n\n.reply-guy-edit-btn {\n  background: white;\n  color: #667eea;\n  border: 2px solid #667eea;\n  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);\n}\n\n.reply-guy-edit-btn:hover {\n  background: #f8f9ff;\n  transform: translateY(-1px);\n  box-shadow: 0 4px 12px rgba(102, 126, 234, 0.2);\n}\n\n.reply-guy-notice {\n  margin-top: 12px;\n  padding: 12px 16px;\n  border-radius: 8px;\n  font-size: 14px;\n  text-align: center;\n}\n\n.reply-guy-copy-notice {\n  background: #d4edda;\n  border: 1px solid #c3e6cb;\n  color: #155724;\n}\n\n.reply-guy-meme-notice {\n  background: #d1ecf1;\n  border: 1px solid #bee5eb;\n  color: #0c5460;\n}\n\n/* Edit mode specific styles */\n.reply-guy-edit-container {\n  padding: 20px;\n}\n\n.reply-guy-edit-section {\n  margin-bottom: 20px;\n}\n\n.reply-guy-edit-label {\n  display: block;\n  font-size: 14px;\n  font-weight: 600;\n  color: #536471;\n  margin-bottom: 8px;\n}\n\n.reply-guy-context-box {\n  background: #f7f9fa;\n  border: 1px solid #e1e8ed;\n  border-radius: 8px;\n  padding: 12px;\n  font-size: 14px;\n  color: #536471;\n  margin-bottom: 8px;\n}\n\n.reply-guy-edit-textarea {\n  width: 100%;\n  padding: 12px;\n  border: 2px solid #e1e8ed;\n  border-radius: 8px;\n  font-size: 15px;\n  line-height: 1.5;\n  resize: vertical;\n  min-height: 100px;\n  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;\n  transition: border-color 0.2s;\n}\n\n.reply-guy-edit-textarea:focus {\n  outline: none;\n  border-color: #667eea;\n}\n\n.reply-guy-edit-input {\n  width: 100%;\n  padding: 10px 12px;\n  border: 2px solid #e1e8ed;\n  border-radius: 8px;\n  font-size: 14px;\n  transition: border-color 0.2s;\n}\n\n.reply-guy-edit-input:focus {\n  outline: none;\n  border-color: #667eea;\n}\n\n.reply-guy-char-count {\n  text-align: right;\n  font-size: 13px;\n  color: #536471;\n  margin-top: 4px;\n}\n\n.reply-guy-edit-actions {\n  display: flex;\n  gap: 12px;\n  justify-content: flex-end;\n  margin-top: 20px;\n}\n\n.reply-guy-save-btn {\n  padding: 10px 24px;\n  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\n  color: white;\n  border: none;\n  border-radius: 8px;\n  font-size: 15px;\n  font-weight: 600;\n  cursor: pointer;\n  transition: all 0.2s;\n}\n\n.reply-guy-save-btn:hover:not(:disabled) {\n  transform: translateY(-1px);\n  box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);\n}\n\n.reply-guy-save-btn:disabled {\n  opacity: 0.6;\n  cursor: not-allowed;\n}\n\n.reply-guy-cancel-btn {\n  padding: 10px 24px;\n  background: white;\n  color: #536471;\n  border: 2px solid #e1e8ed;\n  border-radius: 8px;\n  font-size: 15px;\n  font-weight: 600;\n  cursor: pointer;\n  transition: all 0.2s;\n}\n\n.reply-guy-cancel-btn:hover {\n  background: #f7f9fa;\n  border-color: #d1d5da;\n}\n\n/* Collapsible sections */\n.reply-guy-collapsible-section {\n  margin-top: 12px;\n  padding: 12px;\n  background: #f8f9fa;\n  border-radius: 8px;\n}\n\n/* Error icon */\n.reply-guy-error-icon {\n  font-size: 48px;\n  margin-bottom: 12px;\n}\n\n/* Simple overlay styles for suggestion list */\n.reply-guy-overlay.reply-guy-suggestions-list {\n  position: absolute;\n  z-index: 10000;\n  background: white;\n  border-radius: 12px;\n  box-shadow: 0 4px 24px rgba(0, 0, 0, 0.15);\n  padding: 16px;\n  max-width: 500px;\n  margin-top: 8px;\n  animation: slideIn 0.2s ease-out;\n}\n\n.reply-guy-overlay .reply-guy-logo {\n  width: 20px;\n  height: 20px;\n  margin-right: 8px;\n  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\n  border-radius: 4px;\n}\n\n.reply-guy-overlay .reply-guy-suggestions {\n  display: flex;\n  flex-direction: column;\n  gap: 8px;\n}\n\n.reply-guy-overlay .reply-guy-suggestion {\n  padding: 12px;\n  background: #f8f9fa;\n  border: 1px solid #e9ecef;\n  border-radius: 8px;\n  cursor: pointer;\n  transition: all 0.2s;\n  font-size: 14px;\n  line-height: 1.5;\n  color: #1a1a1a;\n}\n\n.reply-guy-overlay .reply-guy-suggestion:hover {\n  background: #e9ecef;\n  border-color: #667eea;\n  transform: translateX(4px);\n}',""]);const l=s},56:(e,n,t)=>{e.exports=function(e){var n=t.nc;n&&e.setAttribute("nonce",n)}},72:e=>{var n=[];function t(e){for(var t=-1,o=0;o<n.length;o++)if(n[o].identifier===e){t=o;break}return t}function o(e,o){for(var i={},s=[],l=0;l<e.length;l++){var a=e[l],c=o.base?a[0]+o.base:a[0],p=i[c]||0,y="".concat(c," ").concat(p);i[c]=p+1;var d=t(y),u={css:a[1],media:a[2],sourceMap:a[3],supports:a[4],layer:a[5]};if(-1!==d)n[d].references++,n[d].updater(u);else{var g=r(u,o);o.byIndex=l,n.splice(l,0,{identifier:y,updater:g,references:1})}s.push(y)}return s}function r(e,n){var t=n.domAPI(n);return t.update(e),function(n){if(n){if(n.css===e.css&&n.media===e.media&&n.sourceMap===e.sourceMap&&n.supports===e.supports&&n.layer===e.layer)return;t.update(e=n)}else t.remove()}}e.exports=function(e,r){var i=o(e=e||[],r=r||{});return function(e){e=e||[];for(var s=0;s<i.length;s++){var l=t(i[s]);n[l].references--}for(var a=o(e,r),c=0;c<i.length;c++){var p=t(i[c]);0===n[p].references&&(n[p].updater(),n.splice(p,1))}i=a}}},113:e=>{e.exports=function(e,n){if(n.styleSheet)n.styleSheet.cssText=e;else{for(;n.firstChild;)n.removeChild(n.firstChild);n.appendChild(document.createTextNode(e))}}},159:e=>{e.exports=function(e){var n=document.createElement("style");return e.setAttributes(n,e.attributes),e.insert(n,e.options),n}},314:e=>{e.exports=function(e){var n=[];return n.toString=function(){return this.map(function(n){var t="",o=void 0!==n[5];return n[4]&&(t+="@supports (".concat(n[4],") {")),n[2]&&(t+="@media ".concat(n[2]," {")),o&&(t+="@layer".concat(n[5].length>0?" ".concat(n[5]):""," {")),t+=e(n),o&&(t+="}"),n[2]&&(t+="}"),n[4]&&(t+="}"),t}).join("")},n.i=function(e,t,o,r,i){"string"==typeof e&&(e=[[null,e,void 0]]);var s={};if(o)for(var l=0;l<this.length;l++){var a=this[l][0];null!=a&&(s[a]=!0)}for(var c=0;c<e.length;c++){var p=[].concat(e[c]);o&&s[p[0]]||(void 0!==i&&(void 0===p[5]||(p[1]="@layer".concat(p[5].length>0?" ".concat(p[5]):""," {").concat(p[1],"}")),p[5]=i),t&&(p[2]?(p[1]="@media ".concat(p[2]," {").concat(p[1],"}"),p[2]=t):p[2]=t),r&&(p[4]?(p[1]="@supports (".concat(p[4],") {").concat(p[1],"}"),p[4]=r):p[4]="".concat(r)),n.push(p))}},n}},601:e=>{e.exports=function(e){return e[1]}},659:e=>{var n={};e.exports=function(e,t){var o=function(e){if(void 0===n[e]){var t=document.querySelector(e);if(window.HTMLIFrameElement&&t instanceof window.HTMLIFrameElement)try{t=t.contentDocument.head}catch(e){t=null}n[e]=t}return n[e]}(e);if(!o)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");o.appendChild(t)}},825:e=>{e.exports=function(e){if("undefined"==typeof document)return{update:function(){},remove:function(){}};var n=e.insertStyleElement(e);return{update:function(t){!function(e,n,t){var o="";t.supports&&(o+="@supports (".concat(t.supports,") {")),t.media&&(o+="@media ".concat(t.media," {"));var r=void 0!==t.layer;r&&(o+="@layer".concat(t.layer.length>0?" ".concat(t.layer):""," {")),o+=t.css,r&&(o+="}"),t.media&&(o+="}"),t.supports&&(o+="}");var i=t.sourceMap;i&&"undefined"!=typeof btoa&&(o+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(i))))," */")),n.styleTagTransform(o,e,n.options)}(n,e,t)},remove:function(){!function(e){if(null===e.parentNode)return!1;e.parentNode.removeChild(e)}(n)}}}}},n={};function t(o){var r=n[o];if(void 0!==r)return r.exports;var i=n[o]={id:o,exports:{}};return e[o](i,i.exports,t),i.exports}t.n=e=>{var n=e&&e.__esModule?()=>e.default:()=>e;return t.d(n,{a:n}),n},t.d=(e,n)=>{for(var o in n)t.o(n,o)&&!t.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:n[o]})},t.o=(e,n)=>Object.prototype.hasOwnProperty.call(e,n),t.nc=void 0;var o=t(72),r=t.n(o),i=t(825),s=t.n(i),l=t(659),a=t.n(l),c=t(56),p=t.n(c),y=t(159),d=t.n(y),u=t(113),g=t.n(u),h=t(45),m={};m.styleTagTransform=g(),m.setAttributes=p(),m.insert=a().bind(null,"head"),m.domAPI=s(),m.insertStyleElement=d(),r()(h.A,m),h.A&&h.A.locals&&h.A.locals;class f{constructor(e){this.overlay=null,this.responseType="neutral",this.tone="friendly",this.responseIdea="",this.replyLength="short",this.needsResearch=!1,this.perplexityGuidance="",this.includeMeme=!1,this.memeText="",this.currentReplyData=null,this.originalTweet="",this.memeTextMode="exact",this.tweet="",this.userPlan=null,this.usageLimits=null,this.isSuggestingIdea=!1,this.isSuggestingResearch=!1,this.researchSuggestions=[],this.useCustomStyle=!1,this.enableStyleMatching=!0,this.defaultSettings={},this.handleOutsideClick=e=>{const n=e.target,t=n.closest('[data-testid="reply"]')||n.closest('[role="group"]');!this.overlay||this.overlay.contains(n)||t||this.remove()},this.container=e}getReplyLengthLimit(e){switch(e){case"short":default:return 280;case"medium":return 560;case"long":return 1e3;case"extra-long":return 2e3}}async saveUserSettings(){if(chrome?.storage?.sync)try{await chrome.storage.sync.set({replyGuySettings:{responseType:this.responseType,tone:this.tone,replyLength:this.replyLength,needsResearch:this.needsResearch,includeMemes:this.includeMeme,useCustomStyle:this.useCustomStyle,enableStyleMatching:this.enableStyleMatching}}),console.log("[ReplyGuy] Saved user settings")}catch(e){console.error("[ReplyGuy] Failed to save settings:",e)}}async loadUserSettings(){if(chrome?.storage?.sync)try{const e=await chrome.storage.sync.get(["replyGuySettings"]);if(e.replyGuySettings){const n=e.replyGuySettings;console.log("[ReplyGuy] Loading saved settings:",n),this.responseType=n.responseType||this.responseType,console.log("[ReplyGuy] - responseType:",this.responseType),this.tone=n.tone||this.tone,console.log("[ReplyGuy] - tone:",this.tone),this.replyLength=n.replyLength||this.replyLength,console.log("[ReplyGuy] - replyLength:",this.replyLength),this.needsResearch=n.needsResearch??this.needsResearch,console.log("[ReplyGuy] - needsResearch:",this.needsResearch),this.includeMeme=n.includeMemes??this.includeMeme,console.log("[ReplyGuy] - includeMeme:",this.includeMeme),this.useCustomStyle=n.useCustomStyle??this.useCustomStyle,console.log("[ReplyGuy] - useCustomStyle:",this.useCustomStyle),this.enableStyleMatching=n.enableStyleMatching??this.enableStyleMatching,console.log("[ReplyGuy] - enableStyleMatching:",this.enableStyleMatching)}else console.log("[ReplyGuy] No saved settings found, using defaults")}catch(e){console.error("[ReplyGuy] Failed to load settings:",e)}}async showOptions(e,n){this.remove(),this.tweet=e,this.originalTweet=e,await this.loadUserSettings();try{if(!chrome.runtime?.id)return void console.error("[ReplyGuy] Extension context invalid");const e=await chrome.runtime.sendMessage({action:"getUsageLimits"});e.success&&e.data&&(this.usageLimits=e.data,this.userPlan=e.data.userPlan||e.data,console.log("[ReplyGuy] User plan loaded:",this.userPlan),console.log("[ReplyGuy] Usage limits:",this.usageLimits))}catch(e){if(e instanceof Error&&e.message.includes("Extension context invalidated"))return console.error("[ReplyGuy] Extension context invalidated"),void this.showError("Reply Guy extension needs to be refreshed. Please reload this page.");console.error("[ReplyGuy] Failed to get user plan:",e)}this.overlay=document.createElement("div"),this.overlay.className="reply-guy-overlay",this.overlay.innerHTML=`\n      <div class="reply-guy-header">\n        <div class="reply-guy-title">\n          <img src="${chrome.runtime.getURL("icons/reply_guy_logo.png")}" class="reply-guy-logo-icon" alt="Reply Guy" />\n          <span>Reply Guy</span>\n        </div>\n        <button class="reply-guy-close" aria-label="Close">√ó</button>\n      </div>\n      \n      <div class="reply-guy-content-scroll">\n        \x3c!-- Tweet Preview --\x3e\n        <div class="reply-guy-tweet-section">\n          <div class="reply-guy-tweet-preview">\n            ${this.escapeHtml(e)}\n          </div>\n        </div>\n        \n        \x3c!-- Response Idea --\x3e\n        <div class="reply-guy-option-group">\n          <div class="reply-guy-label-with-action">\n            <label class="reply-guy-option-label" for="reply-guy-idea">What do you want to say?</label>\n            <button class="reply-guy-suggest-btn" id="reply-guy-suggest">\n              <svg width="14" height="14" viewBox="0 0 24 24" fill="none">\n                <path d="M12 2L13.09 8.26L19 7L15.45 11.82L21 16L14.5 16.5L15 23L10.18 17.45L5 21L5.5 14.5L0 16L5.55 11.18L2 7L7.91 8.26L9 2L12 2Z" fill="currentColor"/>\n              </svg>\n              Suggest\n            </button>\n          </div>\n          <textarea \n            id="reply-guy-idea" \n            class="reply-guy-idea-input" \n            placeholder="Describe your response (e.g., 'Sympathize and share a similar experience')"\n            rows="3"\n            maxlength="${this.userPlan?.max_response_idea_length||200}"\n          >${this.responseIdea}</textarea>\n          <div class="reply-guy-char-count">\n            <span id="idea-char-count">0</span> / <span id="idea-char-limit">${this.userPlan?.max_response_idea_length||200}</span>\n          </div>\n        </div>\n        \n        \x3c!-- Core Controls: Type, Tone, Length --\x3e\n        <div class="reply-guy-grid-3-col">\n          \x3c!-- Response Type --\x3e\n          <div class="reply-guy-option-group">\n            <label class="reply-guy-option-label" for="reply-guy-response-type">Type</label>\n            <select class="reply-guy-select" id="reply-guy-response-type">\n              <option value="agree">üëç Agree</option>\n              <option value="disagree">ü§î Disagree</option>\n              <option value="neutral" selected>üí≠ Neutral</option>\n              <option value="other">‚ú® Creative</option>\n            </select>\n          </div>\n          \n          \x3c!-- Tone --\x3e\n          <div class="reply-guy-option-group">\n            <label class="reply-guy-option-label" for="reply-guy-tone">Tone</label>\n            <select class="reply-guy-select" id="reply-guy-tone">\n              <option value="friendly">üòä Friendly</option>\n              <option value="professional">üíº Professional</option>\n              <option value="casual">üëã Casual</option>\n              <option value="humorous">üòÑ Humorous</option>\n              <option value="empathetic">‚ù§Ô∏è Empathetic</option>\n              <option value="witty">üéØ Witty</option>\n              <option value="sarcastic">üòè Sarcastic</option>\n              <option value="supportive">ü§ù Supportive</option>\n              <option value="informative">üìö Informative</option>\n              <option value="formal">üé© Formal</option>\n            </select>\n          </div>\n          \n          \x3c!-- Reply Length --\x3e\n          <div class="reply-guy-option-group">\n            <label class="reply-guy-option-label" for="reply-guy-length">Length</label>\n            <select class="reply-guy-select" id="reply-guy-length">\n              <option value="short">Short (280)</option>\n              <option value="medium" ${this.userPlan?.enable_long_replies?"":"disabled"}>Medium (560) ${this.userPlan?.enable_long_replies?"":"üîí"}</option>\n              <option value="long" ${this.userPlan?.enable_long_replies?"":"disabled"}>Long (1000) ${this.userPlan?.enable_long_replies?"":"üîí"}</option>\n              <option value="extra-long" ${!this.userPlan?.enable_long_replies||this.userPlan?.max_reply_length<2e3?"disabled":""}>Extra Long (2000) ${!this.userPlan?.enable_long_replies||this.userPlan?.max_reply_length<2e3?"üîí":""}</option>\n            </select>\n          </div>\n        </div>\n        \n        \x3c!-- Feature Toggles --\x3e\n        <div class="reply-guy-features-grid">\n          ${!1!==this.userPlan?.enable_write_like_me?'\n          <div class="reply-guy-option-group">\n            <label class="reply-guy-checkbox">\n              <input type="checkbox" id="reply-guy-write-like-me">\n              <span>Write like me ‚úçÔ∏è</span>\n            </label>\n          </div>\n          ':""}\n          \n          ${!1!==this.userPlan?.enable_style_matching?'\n          <div class="reply-guy-option-group">\n            <label class="reply-guy-checkbox">\n              <input type="checkbox" id="reply-guy-match-style">\n              <span>Match tweet style üé®</span>\n            </label>\n          </div>\n          ':""}\n          \n          ${!1!==this.userPlan?.enable_perplexity_guidance?'\n          <div class="reply-guy-option-group">\n            <label class="reply-guy-checkbox">\n              <input type="checkbox" id="reply-guy-research">\n              <span>Add research üîç</span>\n            </label>\n          </div>\n          ':""}\n          \n          ${!1!==this.userPlan?.enable_memes?'\n          <div class="reply-guy-option-group">\n            <label class="reply-guy-checkbox">\n              <input type="checkbox" id="reply-guy-meme">\n              <span>Add a meme üé≠</span>\n            </label>\n          </div>\n          ':""}\n        </div>\n        \n        \x3c!-- Conditional Sections for Research and Meme --\x3e\n        <div id="reply-guy-research-section" class="reply-guy-collapsible-section" style="display: none;">\n          <div class="reply-guy-label-with-action">\n            <label class="reply-guy-option-label" for="reply-guy-perplexity">Research Guidance (Optional)</label>\n            <button class="reply-guy-suggest-btn" id="reply-guy-suggest-research" type="button">\n              <svg width="14" height="14" viewBox="0 0 24 24" fill="none">\n                <path d="M12 2L13.09 8.26L19 7L15.45 11.82L21 16L14.5 16.5L15 23L10.18 17.45L5 21L5.5 14.5L0 16L5.55 11.18L2 7L7.91 8.26L9 2L12 2Z" fill="currentColor"/>\n              </svg>\n              Suggest\n            </button>\n          </div>\n          <textarea\n            id="reply-guy-perplexity" \n            class="reply-guy-text-input" \n            placeholder="What specific facts, stats, or current events should we look for?"\n            rows="2"\n            maxlength="200"\n          ></textarea>\n          <div id="reply-guy-research-suggestions" style="display: none; margin-top: 8px;">\n            <p class="reply-guy-suggestion-label">Suggestions:</p>\n            <div class="reply-guy-suggestion-chips"></div>\n          </div>\n        </div>\n        \n        <div id="reply-guy-meme-options" class="reply-guy-collapsible-section" style="display: none;">\n          <div class="reply-guy-option-group">\n            <label class="reply-guy-option-label" style="font-size: 11px;">Meme text (optional)</label>\n            <input \n              type="text"\n              id="reply-guy-meme-text" \n              class="reply-guy-text-input" \n              placeholder="e.g., 'this is fine' or 'bugs everywhere'"\n              maxlength="100"\n            />\n          </div>\n          \n          <div id="reply-guy-meme-mode-section" style="display: none; margin-top: 12px;">\n            <div class="reply-guy-meme-mode">\n              <label class="reply-guy-radio">\n                <input type="radio" name="memeTextMode" value="exact" checked>\n                <span>Use my exact text</span>\n              </label>\n              <label class="reply-guy-radio">\n                <input type="radio" name="memeTextMode" value="enhance">\n                <span>Make it more creative with AI ‚ú®</span>\n              </label>\n            </div>\n          </div>\n          \n          <div class="reply-guy-meme-info">\n            <p id="meme-info-empty">üí° <strong>Leave blank</strong> = AI creates meme text from your reply</p>\n            <p id="meme-info-exact" style="display: none;">‚úèÔ∏è Your exact text will be used: "<span id="meme-preview-text"></span>"</p>\n            <p id="meme-info-enhance" style="display: none;">‚ú® AI will enhance your idea to make it funnier</p>\n          </div>\n        </div>\n      </div>\n      \n      \x3c!-- Footer Actions and Usage --\x3e\n      <div class="reply-guy-footer">\n        <div class="reply-guy-actions">\n          <button class="reply-guy-generate-btn" id="reply-guy-generate">\n            Generate Reply\n          </button>\n        </div>\n        <label class="reply-guy-checkbox reply-guy-save-defaults-checkbox">\n          <input type="checkbox" id="reply-guy-save-defaults">\n          <span>Save as default settings</span>\n        </label>\n        \n        ${this.usageLimits?`\n        <div class="reply-guy-usage-stats">\n          <div class="reply-guy-usage-item">\n            <span>Replies:</span>\n            <span class="reply-guy-usage-value">${(this.usageLimits.repliesTotal||0)-(this.usageLimits.repliesRemaining||0)} / ${this.usageLimits.repliesTotal||0}</span>\n          </div>\n          ${void 0!==this.usageLimits.dailyCount?`\n          <div class="reply-guy-usage-item">\n            <span>Daily Goal:</span>\n            <span class="reply-guy-usage-value">${this.usageLimits.dailyCount||0} / ${this.usageLimits.dailyGoal||10}</span>\n          </div>\n          `:""}\n        </div>\n        `:""}\n      </div>\n    `;const t=this.container.getBoundingClientRect();this.overlay.style.position="fixed";const o=.8*window.innerHeight;window.innerHeight-t.bottom-16<o&&t.top>o?(this.overlay.style.bottom=window.innerHeight-t.top+8+"px",this.overlay.style.top="auto"):this.overlay.style.top=`${Math.min(t.bottom+8,window.innerHeight-o)}px`,this.overlay.style.left=`${Math.min(t.left,window.innerWidth-500)}px`,this.overlay.style.width="480px",this.attachEventListeners(n),document.body.appendChild(this.overlay),setTimeout(()=>{const e=this.overlay?.querySelector("#reply-guy-idea");e&&(e.style.visibility="visible",e.style.pointerEvents="auto",e.click(),e.focus(),e.setSelectionRange(e.value.length,e.value.length),console.log("[ReplyGuy] Auto-focused idea input"),requestAnimationFrame(()=>{document.activeElement!==e&&(e.focus(),console.log("[ReplyGuy] Fallback focus applied"))}))},50),setTimeout(()=>{document.addEventListener("click",this.handleOutsideClick)},200)}attachEventListeners(e){if(!this.overlay)return;this.overlay.querySelector(".reply-guy-close")?.addEventListener("click",()=>this.remove());const n=this.overlay.querySelector("#reply-guy-response-type");n&&(n.value=this.responseType,n.addEventListener("change",()=>{this.responseType=n.value,console.log("[ReplyGuy] Response type changed to:",this.responseType)}));const t=this.overlay.querySelector("#reply-guy-tone");t&&(t.value=this.tone,t.addEventListener("change",()=>{this.tone=t.value,console.log("[ReplyGuy] Tone changed to:",this.tone)}));const o=this.overlay.querySelector("#reply-guy-idea"),r=this.overlay.querySelector("#idea-char-count");if(this.overlay.querySelector("#idea-char-limit"),o&&r){const e=this.userPlan?.max_response_idea_length||200,n=()=>{const n=o.value.length;r.textContent=n.toString(),o.classList.toggle("error",n>e)};o.addEventListener("input",()=>{this.responseIdea=o.value,n()}),n()}this.overlay.querySelector("#reply-guy-suggest")?.addEventListener("click",async e=>{if(e.preventDefault(),e.stopPropagation(),console.log("[ReplyGuy] Suggest button clicked"),!this.tweet.trim())return void this.showInlineError("Please wait for tweet to load");const n=this.overlay?.querySelector("#reply-guy-suggest");if(!n||n.disabled)return;n.disabled=!0;const t=n.innerHTML;n.innerHTML='<svg class="reply-guy-spinner-small" width="14" height="14" viewBox="0 0 24 24"><circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4" fill="none" stroke-dasharray="31.4" stroke-dashoffset="10"></circle></svg> Suggesting...';try{if(!chrome.runtime?.id)throw new Error("Extension context invalidated");const e=await chrome.runtime.sendMessage({action:"getSuggestions",data:{tweet:this.tweet,responseType:this.responseType,tone:this.tone}});if(e&&e.success&&e.data?.suggestion)this.responseIdea=e.data.suggestion,o&&(o.value=this.responseIdea,o.dispatchEvent(new Event("input")));else{const n=e?.error||"Failed to get suggestion";console.error("[ReplyGuy] Failed to get suggestion:",n),n.includes("limit")?this.showInlineError("You have reached your suggestion limit. Please upgrade your plan."):this.showInlineError("Failed to generate suggestion. Please try again.")}}catch(e){console.error("[ReplyGuy] Suggest error:",e),e instanceof Error&&e.message.includes("Extension context invalidated")?this.showInlineError("Reply Guy extension needs to be refreshed. Please reload this page."):this.showInlineError("An error occurred. Please try again.")}finally{n&&this.overlay&&(n.disabled=!1,n.innerHTML=t)}});const i=this.overlay.querySelector("#reply-guy-length");i&&(i.value=this.replyLength,i.addEventListener("change",()=>{this.replyLength=i.value,console.log("[ReplyGuy] Reply length changed to:",this.replyLength)}));const s=this.overlay.querySelector("#reply-guy-research"),l=this.overlay.querySelector("#reply-guy-research-section"),a=this.overlay.querySelector("#reply-guy-perplexity");s&&(s.checked=this.needsResearch,l&&(l.style.display=this.needsResearch?"block":"none"),s.addEventListener("change",()=>{this.needsResearch=s.checked,l&&(l.style.display=this.needsResearch?"block":"none")})),a?.addEventListener("input",()=>{this.perplexityGuidance=a.value}),this.overlay.querySelector("#reply-guy-suggest-research")?.addEventListener("click",async e=>{if(e.preventDefault(),e.stopPropagation(),!this.tweet.trim()||!this.responseIdea.trim())return void this.showInlineError("Please enter a tweet and response idea first");const n=this.overlay?.querySelector("#reply-guy-suggest-research");n&&(n.disabled=!0,n.innerHTML='<svg class="reply-guy-spinner-small" width="14" height="14" viewBox="0 0 24 24"><circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4" fill="none" stroke-dasharray="31.4" stroke-dashoffset="10"></circle></svg> Suggesting...');try{if(!chrome.runtime?.id)throw new Error("Extension context invalidated");const e=await chrome.runtime.sendMessage({action:"getSuggestResearch",data:{originalTweet:this.tweet,responseIdea:this.responseIdea,responseType:this.responseType,tone:this.tone}});e.success&&e.data?.suggestions&&(this.researchSuggestions=e.data.suggestions,this.showResearchSuggestions())}catch(e){console.error("[ReplyGuy] Research suggest error:",e),e instanceof Error&&e.message.includes("Extension context invalidated")&&this.showInlineError("Reply Guy extension needs to be refreshed. Please reload this page.")}finally{n&&(n.disabled=!1,n.innerHTML='<svg width="14" height="14" viewBox="0 0 24 24" fill="none"><path d="M12 2L13.09 8.26L19 7L15.45 11.82L21 16L14.5 16.5L15 23L10.18 17.45L5 21L5.5 14.5L0 16L5.55 11.18L2 7L7.91 8.26L9 2L12 2Z" fill="currentColor"/></svg> Suggest')}});const c=this.overlay.querySelector("#reply-guy-meme"),p=this.overlay.querySelector("#reply-guy-meme-options"),y=this.overlay.querySelector("#reply-guy-meme-text"),d=this.overlay.querySelector("#reply-guy-meme-mode-section"),u=this.overlay.querySelector("#meme-info-empty"),g=this.overlay.querySelector("#meme-info-exact"),h=this.overlay.querySelector("#meme-info-enhance"),m=this.overlay.querySelector("#meme-preview-text");if(c&&this.userPlan){const e=this.userPlan.memes_used<this.userPlan.meme_limit;if(c.disabled=!e,e)c.checked=this.includeMeme,p&&(p.style.display=this.includeMeme?"block":"none");else{const e=c.parentElement;e&&(e.style.opacity="0.5",e.style.cursor="not-allowed")}}c?.addEventListener("change",()=>{this.includeMeme=c.checked,p&&(p.style.display=this.includeMeme?"block":"none"),this.includeMeme||(this.memeText="",y&&(y.value=""))});const f=()=>{const e=this.memeText.trim().length>0;if(d&&(d.style.display=e?"block":"none"),e){m&&(m.textContent=this.memeText);const e="exact"===this.memeTextMode;u&&(u.style.display="none"),g&&(g.style.display=e?"block":"none"),h&&(h.style.display=e?"none":"block")}else u&&(u.style.display="block"),g&&(g.style.display="none"),h&&(h.style.display="none")};y?.addEventListener("input",()=>{this.memeText=y.value,f()}),this.overlay.querySelectorAll('input[name="memeTextMode"]').forEach(e=>{e.addEventListener("change",e=>{this.memeTextMode=e.target.value,f()})});const v=this.overlay.querySelector("#reply-guy-write-like-me");v?(v.checked=this.useCustomStyle||!1,console.log("[ReplyGuy] Write Like Me initial state:",this.useCustomStyle),v.addEventListener("change",()=>{this.useCustomStyle=v.checked,console.log("[ReplyGuy] Write Like Me changed to:",this.useCustomStyle)})):(this.useCustomStyle=!1,console.log("[ReplyGuy] Write Like Me feature not available in user plan"));const x=this.overlay.querySelector("#reply-guy-match-style");x?(x.checked=!1!==this.enableStyleMatching,this.enableStyleMatching=x.checked,console.log("[ReplyGuy] Match Tweet Style initial state:",this.enableStyleMatching),x.addEventListener("change",()=>{this.enableStyleMatching=x.checked,console.log("[ReplyGuy] Match Tweet Style changed to:",this.enableStyleMatching)})):(this.enableStyleMatching=!1,console.log("[ReplyGuy] Match Tweet Style feature not available in user plan")),this.overlay.querySelector("#reply-guy-generate")?.addEventListener("click",async()=>{if(!this.responseIdea.trim())return void this.showInlineError("Please describe what you want to say");const n=this.userPlan?.max_tweet_length||280,t={originalTweet:this.tweet.length>n?this.tweet.substring(0,n)+"...":this.tweet,responseIdea:this.responseIdea,responseType:this.responseType,tone:this.tone,replyLength:this.replyLength,needsResearch:this.needsResearch,includeMeme:this.includeMeme,useCustomStyle:this.useCustomStyle||!1,enableStyleMatching:this.enableStyleMatching||!1};if(this.needsResearch&&this.perplexityGuidance&&(t.perplexityGuidance=this.perplexityGuidance),this.includeMeme&&this.memeText&&(t.memeText=this.memeText,t.memeTextMode=this.memeTextMode),chrome?.runtime?.id)try{const e=await chrome.runtime.sendMessage({action:"checkAuth"});e?.success&&e.data?.user?.id&&(t.userId=e.data.user.id)}catch(e){console.error("[ReplyGuy] Failed to get user ID:",e)}console.log("[ReplyGuy] ===== VALIDATION DEBUG ====="),console.log("[ReplyGuy] originalTweet:",t.originalTweet,"type:",typeof t.originalTweet,"length:",t.originalTweet?.length),console.log("[ReplyGuy] responseIdea:",t.responseIdea,"type:",typeof t.responseIdea,"length:",t.responseIdea?.length),console.log("[ReplyGuy] responseType:",t.responseType,"type:",typeof t.responseType),console.log("[ReplyGuy] tone:",t.tone,"type:",typeof t.tone),console.log("[ReplyGuy] needsResearch:",t.needsResearch,"type:",typeof t.needsResearch),console.log("[ReplyGuy] replyLength:",t.replyLength,"type:",typeof t.replyLength),console.log("[ReplyGuy] includeMeme:",t.includeMeme,"type:",typeof t.includeMeme),console.log("[ReplyGuy] useCustomStyle:",t.useCustomStyle,"type:",typeof t.useCustomStyle),console.log("[ReplyGuy] enableStyleMatching:",t.enableStyleMatching,"type:",typeof t.enableStyleMatching),console.log("[ReplyGuy] perplexityGuidance:",t.perplexityGuidance,"type:",typeof t.perplexityGuidance),console.log("[ReplyGuy] memeText:",t.memeText,"type:",typeof t.memeText),console.log("[ReplyGuy] memeTextMode:",t.memeTextMode,"type:",typeof t.memeTextMode),console.log("[ReplyGuy] userId:",t.userId,"type:",typeof t.userId),console.log("[ReplyGuy] Full data object:",JSON.stringify(t,null,2)),console.log("[ReplyGuy] ===== END VALIDATION DEBUG =====");const o=this.overlay?.querySelector("#reply-guy-save-defaults");o?.checked&&this.saveUserSettings(),e(t)})}showGeneratedReply(e,n,t){this.remove(),this.currentReplyData={...t||{},replyLength:this.replyLength},this.overlay=document.createElement("div"),this.overlay.className="reply-guy-overlay",this.overlay.innerHTML=`\n      <div class="reply-guy-header">\n        <div class="reply-guy-title">\n          <img src="${chrome.runtime.getURL("icons/reply_guy_logo.png")}" class="reply-guy-logo-icon" alt="Reply Guy" />\n          <span>Your Reply is Ready!</span>\n        </div>\n        <button class="reply-guy-close" aria-label="Close">√ó</button>\n      </div>\n      \n      <div class="reply-guy-content-scroll">\n        <div class="reply-guy-reply-text">\n          ${this.escapeHtml(e)}\n        </div>\n        \n        ${n?`\n        <div class="reply-guy-meme-preview">\n          <img src="${n}" alt="Generated meme" />\n        </div>\n        `:""}\n      </div>\n      \n      <div class="reply-guy-result-footer">\n        <div class="reply-guy-result-actions">\n          <button class="reply-guy-copy-btn">${n?"üìã Copy & Download":"üìã Copy Reply"}</button>\n          <button class="reply-guy-edit-btn">‚úèÔ∏è Edit</button>\n        </div>\n        \n        <div class="reply-guy-copy-notice reply-guy-notice" style="display: none;">\n          ‚úÖ Reply copied! Click in the reply box and paste with <strong>Ctrl+V</strong> (or <strong>Cmd+V</strong> on Mac)\n        </div>\n        \n        ${n?'\n        <div class="reply-guy-meme-notice reply-guy-notice" style="display: none;">\n          üñºÔ∏è Meme will open in a new window\n        </div>\n        ':""}\n      </div>\n    `;const o=this.container.getBoundingClientRect();this.overlay.style.position="fixed";const r=.8*window.innerHeight;window.innerHeight-o.bottom-16<r&&o.top>r?(this.overlay.style.bottom=window.innerHeight-o.top+8+"px",this.overlay.style.top="auto"):this.overlay.style.top=`${Math.min(o.bottom+8,window.innerHeight-r)}px`,this.overlay.style.left=`${Math.min(o.left,window.innerWidth-500)}px`,this.overlay.style.width="480px",this.overlay.querySelector(".reply-guy-close")?.addEventListener("click",()=>this.remove());const i=this.overlay.querySelector(".reply-guy-copy-btn"),s=this.overlay.querySelector(".reply-guy-edit-btn"),l=this.overlay.querySelector(".reply-guy-copy-notice");i?.addEventListener("click",async()=>{try{await navigator.clipboard.writeText(e),i.textContent="‚úÖ Copied!",i.classList.add("copied"),l&&(l.style.display="block");try{const e=await chrome.runtime.sendMessage({action:"getUsageLimits"});if(e.success&&e.data){const{dailyCount:n,dailyGoal:t}=e.data;if(void 0!==n&&void 0!==t&&n>=t){const e=`celebration_shown_${(new Date).toDateString()}`;chrome.storage.local.get(e,n=>{n[e]||(chrome.runtime.sendMessage({action:"triggerPopupCelebration"}),chrome.storage.local.set({[e]:!0}))})}}}catch(e){console.error("[ReplyGuy] Failed to check celebration status:",e)}if(n)try{if(window.open(n,"_blank","width=600,height=600,toolbar=no,menubar=no,location=no,status=no")){const e=this.overlay?.querySelector(".reply-guy-meme-notice");e&&(e.innerHTML="üñºÔ∏è Meme opened in new window! Right-click the image and save it, then drag into X or use the photo button",e.style.display="block"),console.log("[ReplyGuy] Meme opened in new window"),setTimeout(()=>{window.focus()},100)}else{window.open(n,"_blank");const e=this.overlay?.querySelector(".reply-guy-meme-notice");e&&(e.innerHTML="üñºÔ∏è Meme opened in new tab! Right-click to save it, then return here to paste your reply",e.style.display="block"),console.log("[ReplyGuy] Meme opened in new tab (popup blocked)")}}catch(e){console.error("[ReplyGuy] Failed to open meme in new window:",e);const t=this.overlay?.querySelector(".reply-guy-meme-notice");t&&(t.innerHTML=`üñºÔ∏è <a href="${n}" target="_blank" style="color: #0c5460; text-decoration: underline;">Click here to open meme</a> - then right-click to save`,t.style.display="block")}const t=document.querySelector('[data-testid="tweetTextarea_0"]')||document.querySelector('[role="textbox"][contenteditable="true"]')||this.container.querySelector('[role="textbox"]');t&&t.focus(),setTimeout(()=>{this.remove()},1500)}catch(e){console.error("[ReplyGuy] Failed to copy to clipboard:",e),this.showInlineError("Failed to copy. Please select the text and copy manually.",5e3)}}),s?.addEventListener("click",()=>{this.showEditMode(e)}),setTimeout(()=>{document.addEventListener("click",this.handleOutsideClick)},0),document.body.appendChild(this.overlay)}showEditMode(e){this.remove();const n=this.currentReplyData?.replyLength||this.replyLength||"short",t=this.getReplyLengthLimit(n);this.overlay=document.createElement("div"),this.overlay.className="reply-guy-overlay",this.overlay.innerHTML=`\n      <div class="reply-guy-header">\n        <div class="reply-guy-title">\n          <img src="${chrome.runtime.getURL("icons/reply_guy_logo.png")}" class="reply-guy-logo-icon" alt="Reply Guy" />\n          <span>Improve Your Writing Style</span>\n        </div>\n        <button class="reply-guy-close" aria-label="Close">√ó</button>\n      </div>\n      \n      <div class="reply-guy-edit-container">\n        <div class="reply-guy-edit-section" style="background: #f0f7ff; padding: 12px; border-radius: 8px; margin-bottom: 16px;">\n          <p style="margin: 0; font-size: 14px; color: #536471; line-height: 1.5;">\n            Edit the reply to match how YOU would write it. When you save, your edited reply will be <strong>automatically copied</strong> to the clipboard and your feedback will help improve your writing style.\n          </p>\n        </div>\n        \n        <div class="reply-guy-edit-section">\n          <label class="reply-guy-edit-label">Original Tweet</label>\n          <div class="reply-guy-context-box">\n            ${this.escapeHtml(this.originalTweet||"Tweet content not available")}\n          </div>\n        </div>\n        \n        <div class="reply-guy-edit-section">\n          <label class="reply-guy-edit-label">Your Idea</label>\n          <div class="reply-guy-context-box">\n            ${this.escapeHtml(this.responseIdea||"Response idea not available")}\n          </div>\n        </div>\n        \n        <div class="reply-guy-edit-section">\n          <label class="reply-guy-edit-label" for="reply-guy-edited-reply">\n            ‚ú® Edit to match your style\n          </label>\n          <textarea \n            id="reply-guy-edited-reply" \n            class="reply-guy-edit-textarea"\n            placeholder="Edit this to match how YOU would write it"\n            maxlength="${t}"\n          >${this.escapeHtml(e)}</textarea>\n          <div class="reply-guy-char-count">\n            <span id="reply-guy-char-current">${e.length}</span>/${t} characters\n          </div>\n        </div>\n        \n        <div class="reply-guy-edit-section">\n          <label class="reply-guy-edit-label" for="reply-guy-correction-notes">\n            What did we get wrong? (Optional)\n          </label>\n          <input \n            type="text"\n            id="reply-guy-correction-notes" \n            class="reply-guy-edit-input"\n            placeholder="e.g., 'Too formal' or 'I never use exclamation marks'"\n          />\n        </div>\n        \n        <div class="reply-guy-edit-actions">\n          <button class="reply-guy-cancel-btn">Cancel</button>\n          <button class="reply-guy-save-btn" id="reply-guy-save-edit">Save & Copy Edited Reply</button>\n        </div>\n      </div>\n    `,this.container.getBoundingClientRect(),this.overlay.style.position="fixed";const o=Math.min(.8*window.innerHeight,600);this.overlay.style.top="50%",this.overlay.style.left="50%",this.overlay.style.transform="translate(-50%, -50%)",this.overlay.style.width="520px",this.overlay.style.maxHeight=`${o}px`,this.overlay.style.overflowY="auto";const r=this.overlay.querySelector(".reply-guy-close"),i=this.overlay.querySelector(".reply-guy-cancel-btn"),s=this.overlay.querySelector("#reply-guy-save-edit"),l=this.overlay.querySelector("#reply-guy-edited-reply"),a=this.overlay.querySelector("#reply-guy-char-current"),c=this.overlay.querySelector("#reply-guy-correction-notes");r?.addEventListener("click",()=>this.remove()),i?.addEventListener("click",()=>this.remove()),l?.addEventListener("input",()=>{const n=l.value.length;a&&(a.textContent=n.toString()),s&&(s.disabled=l.value.trim()===e.trim())}),s?.addEventListener("click",async()=>{const n=l.value.trim(),t=c.value.trim();if(n!==e.trim()){s.disabled=!0,s.textContent="Saving...";try{const o=await chrome.runtime.sendMessage({action:"submitCorrection",data:{styleId:this.currentReplyData?.styleId||void 0,originalTweet:this.originalTweet||this.tweet,responseIdea:this.responseIdea,replyType:this.currentReplyData?.replyType||this.responseType,tone:this.currentReplyData?.tone||this.tone,generatedReply:e,correctedReply:n,correctionNotes:t}});if(!o.success)throw new Error(o.error||"Failed to save correction");try{await navigator.clipboard.writeText(n),s.textContent="‚úÖ Saved & Copied!";const e=this.overlay?.querySelector(".reply-guy-edit-container");if(e){const n=document.createElement("div");n.className="reply-guy-copy-notice reply-guy-notice",n.style.marginTop="16px",n.innerHTML="‚úÖ Your edited reply has been copied to clipboard and your feedback saved!<br><strong>Paste it with Ctrl+V (or Cmd+V on Mac)</strong>",e.appendChild(n)}setTimeout(()=>{this.remove()},1500)}catch(e){console.error("[ReplyGuy] Failed to copy to clipboard:",e),s.textContent="‚úÖ Saved! (Copy manually)",l?.select(),setTimeout(()=>{this.remove()},3e3)}}catch(e){console.error("[ReplyGuy] Failed to save correction:",e),s.textContent="Failed - Try Again",s.disabled=!1,setTimeout(()=>{s.textContent="Save & Copy Edited Reply"},2e3)}}}),setTimeout(()=>{l?.focus(),l?.setSelectionRange(l.value.length,l.value.length)},100),document.body.appendChild(this.overlay)}show(e,n){this.remove(),this.overlay=document.createElement("div"),this.overlay.className="reply-guy-overlay reply-guy-suggestions-list",this.overlay.innerHTML=`\n      <div class="reply-guy-header">\n        <div class="reply-guy-title">\n          <div class="reply-guy-logo"></div>\n          Reply Suggestions\n        </div>\n        <button class="reply-guy-close" aria-label="Close">√ó</button>\n      </div>\n      <div class="reply-guy-suggestions">\n        ${e.map((e,n)=>`\n          <div class="reply-guy-suggestion" data-index="${n}">\n            ${this.escapeHtml(e)}\n          </div>\n        `).join("")}\n      </div>\n    `;const t=this.container.getBoundingClientRect();this.overlay.style.position="fixed",this.overlay.style.top=`${t.bottom+window.scrollY}px`,this.overlay.style.left=`${t.left}px`,this.overlay.style.width=`${t.width}px`,this.overlay.querySelector(".reply-guy-close")?.addEventListener("click",()=>this.remove()),this.overlay.querySelectorAll(".reply-guy-suggestion").forEach(t=>{t.addEventListener("click",()=>{const o=parseInt(t.getAttribute("data-index")||"0");n(e[o]),this.remove()})}),setTimeout(()=>{document.addEventListener("click",this.handleOutsideClick)},0),document.body.appendChild(this.overlay)}showLoading(){this.remove(),this.overlay=document.createElement("div"),this.overlay.className="reply-guy-overlay",this.overlay.innerHTML=`\n      <div class="reply-guy-header">\n        <div class="reply-guy-title">\n          <img src="${chrome.runtime.getURL("icons/reply_guy_logo.png")}" class="reply-guy-logo-icon" alt="Reply Guy" />\n          <span>Reply Guy</span>\n        </div>\n      </div>\n      <div class="reply-guy-loading">\n        <img src="${chrome.runtime.getURL("icons/reply_guy_logo.png")}" alt="Generating..." />\n        <div class="reply-guy-loading-text">\n          Crafting the perfect reply\n          <span class="reply-guy-loading-dots">\n            <span class="reply-guy-loading-dot"></span>\n            <span class="reply-guy-loading-dot"></span>\n            <span class="reply-guy-loading-dot"></span>\n          </span>\n        </div>\n      </div>\n    `;const e=this.container.getBoundingClientRect();this.overlay.style.position="fixed";const n=.8*window.innerHeight;window.innerHeight-e.bottom-16<n&&e.top>n?(this.overlay.style.bottom=window.innerHeight-e.top+8+"px",this.overlay.style.top="auto"):this.overlay.style.top=`${Math.min(e.bottom+8,window.innerHeight-n)}px`,this.overlay.style.left=`${Math.min(e.left,window.innerWidth-500)}px`,this.overlay.style.width="400px",document.body.appendChild(this.overlay)}showInlineError(e,n=3e3){const t=document.createElement("div");t.className="reply-guy-inline-error",t.style.cssText="\n      position: fixed;\n      top: 20px;\n      left: 50%;\n      transform: translateX(-50%);\n      background: #dc3545;\n      color: white;\n      padding: 12px 24px;\n      border-radius: 8px;\n      font-size: 14px;\n      z-index: 10001;\n      box-shadow: 0 4px 12px rgba(220, 53, 69, 0.3);\n      animation: slideIn 0.3s ease-out;\n    ",t.textContent=e,document.body.appendChild(t),setTimeout(()=>{t.remove()},n)}showError(e){this.remove(),this.overlay=document.createElement("div"),this.overlay.className="reply-guy-overlay",this.overlay.innerHTML=`\n      <div class="reply-guy-header">\n        <div class="reply-guy-title">\n          <img src="${chrome.runtime.getURL("icons/reply_guy_logo.png")}" class="reply-guy-logo-icon" alt="Reply Guy" />\n          <span>Reply Guy</span>\n        </div>\n        <button class="reply-guy-close" aria-label="Close">√ó</button>\n      </div>\n      <div class="reply-guy-error">\n        <div class="reply-guy-error-icon">‚ö†Ô∏è</div>\n        ${this.escapeHtml(e)}\n      </div>\n    `;const n=this.container.getBoundingClientRect();this.overlay.style.position="fixed";const t=.8*window.innerHeight;window.innerHeight-n.bottom-16<t&&n.top>t?(this.overlay.style.bottom=window.innerHeight-n.top+8+"px",this.overlay.style.top="auto"):this.overlay.style.top=`${Math.min(n.bottom+8,window.innerHeight-t)}px`,this.overlay.style.left=`${Math.min(n.left,window.innerWidth-500)}px`,this.overlay.style.width="400px",this.overlay.querySelector(".reply-guy-close")?.addEventListener("click",()=>this.remove()),document.body.appendChild(this.overlay)}remove(){this.overlay&&(this.overlay.remove(),this.overlay=null,document.removeEventListener("click",this.handleOutsideClick))}escapeHtml(e){const n=document.createElement("div");return n.textContent=e,n.innerHTML}showResearchSuggestions(){const e=this.overlay?.querySelector("#reply-guy-research-suggestions"),n=this.overlay?.querySelector(".reply-guy-suggestion-chips"),t=this.overlay?.querySelector("#reply-guy-perplexity");e&&n&&this.researchSuggestions.length&&(e.style.display="block",n.innerHTML="",this.researchSuggestions.forEach(e=>{const o=document.createElement("button");o.className="reply-guy-suggestion-chip",o.textContent=e,o.addEventListener("click",()=>{this.perplexityGuidance=e,t&&(t.value=e)}),n.appendChild(o)}))}insertGeneratedReply(e,n){const t=document.querySelector('[data-testid="tweetTextarea_0"]')||document.querySelector('[role="textbox"][contenteditable="true"]')||e.querySelector('[role="textbox"]');if(t){t.focus();const e=new InputEvent("beforeinput",{bubbles:!0,cancelable:!0,inputType:"deleteContentBackward"});t.dispatchEvent(e),t.textContent="";try{if(navigator.clipboard&&window.isSecureContext)return void navigator.clipboard.writeText(n).then(()=>{t.focus();const e=document.createRange();e.selectNodeContents(t);const o=window.getSelection();o?.removeAllRanges(),o?.addRange(e),new ClipboardEvent("paste",{bubbles:!0,cancelable:!0,clipboardData:new DataTransfer}),document.execCommand("insertText",!1,n),console.log("[ReplyGuy] Inserted reply using clipboard method")}).catch(()=>{this.insertUsingInputEvents(t,n)})}catch(e){console.log("[ReplyGuy] Clipboard API not available, using input events")}this.insertUsingInputEvents(t,n)}else console.error("[ReplyGuy] Could not find compose textbox")}insertUsingInputEvents(e,n){e.focus();const t=Object.getOwnPropertyDescriptor(window.HTMLInputElement.prototype,"value")?.set||Object.getOwnPropertyDescriptor(window.HTMLTextAreaElement.prototype,"value")?.set;if(t&&(e instanceof HTMLInputElement||e instanceof HTMLTextAreaElement)){t.call(e,n);const o=new Event("input",{bubbles:!0});e.dispatchEvent(o)}else{e.textContent=n;const t=document.createRange(),o=e.firstChild||e;t.setStart(o,e.textContent.length),t.setEnd(o,e.textContent.length);const r=window.getSelection();r?.removeAllRanges(),r?.addRange(t);const i=new InputEvent("input",{bubbles:!0,cancelable:!0,inputType:"insertText",data:n}),s=new InputEvent("beforeinput",{bubbles:!0,cancelable:!0,inputType:"insertText",data:n});e.dispatchEvent(s),e.dispatchEvent(i);const l=new CompositionEvent("compositionend",{bubbles:!0,cancelable:!0,data:n});e.dispatchEvent(l)}e.focus(),console.log("[ReplyGuy] Inserted reply using input events")}}class v{constructor(){this.observer=null,this.overlays=new WeakMap,this.isAuthenticated=!1,this.safetyNetInterval=null}showInlineError(e,n=3e3){const t=document.createElement("div");t.style.cssText="\n      position: fixed;\n      top: 20px;\n      left: 50%;\n      transform: translateX(-50%);\n      background: #dc3545;\n      color: white;\n      padding: 12px 24px;\n      border-radius: 8px;\n      font-size: 14px;\n      z-index: 10001;\n      box-shadow: 0 4px 12px rgba(220, 53, 69, 0.3);\n      animation: slideIn 0.3s ease-out;\n    ",t.textContent=e,document.body.appendChild(t),setTimeout(()=>{t.remove()},n)}initialize(){console.log("[ReplyGuy] Initializing X integration"),console.log("[ReplyGuy] Current URL:",window.location.href),chrome.runtime?.id?(chrome?.runtime?.sendMessage&&chrome.runtime.sendMessage({action:"checkAuth"}).then(e=>{e?.success&&(this.isAuthenticated=e.data?.isAuthenticated||!1,console.log("[ReplyGuy] Auth status:",this.isAuthenticated))}).catch(e=>{e?.message?.includes("Extension context invalidated")?console.error("[ReplyGuy] Extension context invalidated during auth check"):console.error("[ReplyGuy] Failed to check auth:",e)}),this.setupObserver(),this.injectReplyButtons(),this.safetyNetInterval=setInterval(()=>{this.injectReplyButtons()},2e3)):console.error("[ReplyGuy] Extension context invalid during initialization")}cleanup(){this.observer&&(this.observer.disconnect(),this.observer=null),this.safetyNetInterval&&(clearInterval(this.safetyNetInterval),this.safetyNetInterval=null),document.querySelectorAll('[data-testid="replyguy"]').forEach(e=>e.remove())}handleUrlChange(){setTimeout(()=>this.injectReplyButtons(),500)}setupObserver(){let e=null;this.observer=new MutationObserver(()=>{e&&clearTimeout(e),e=setTimeout(()=>{this.injectReplyButtons()},300)}),this.observer.observe(document.body,{childList:!0,subtree:!0})}injectReplyButtons(){const e=document.querySelectorAll("article");0!==e.length&&e.forEach((e,n)=>{if(e.querySelector('[data-testid="replyguy"]'))return;const t=e.querySelector('[role="group"]');if(!t)return;const o=t.querySelector('[data-testid="reply"]')||t.querySelector('[aria-label*="Reply"]');o&&this.createReplyGuyIcon(o,e)})}findReplyButtons(){const e=['[data-testid="reply"]','[aria-label*="Reply"]','[role="button"][aria-label*="Reply"]','div[role="button"] svg path[d*="M1.751 10c0-4.42"]'];let n=[];for(const t of e){const e=document.querySelectorAll(t);if(console.log(`[ReplyGuy] Selector "${t}" found ${e.length} elements`),e.length>0){console.log(`[ReplyGuy] Using ${e.length} reply buttons with selector: ${t}`),n=Array.from(e);break}}if(0===n.length){console.log("[ReplyGuy] No reply buttons found with any selector"),console.log("[ReplyGuy] Sample of buttons on page:");const e=document.querySelectorAll('[role="button"]');console.log(`[ReplyGuy] Total buttons with role="button": ${e.length}`),e.length>0&&Array.from(e).slice(0,5).forEach((e,n)=>{console.log(`[ReplyGuy] Button ${n}:`,e.getAttribute("aria-label"),e.getAttribute("data-testid"))})}return n}createReplyGuyIcon(e,n){const t=document.createElement("div");t.id=`replyguy-btn-${Date.now()}`,t.setAttribute("role","button"),t.setAttribute("data-testid","replyguy"),t.setAttribute("tabindex","0"),Object.assign(t.style,{display:"inline-flex",alignItems:"center",justifyContent:"center",width:"34px",height:"34px",marginLeft:"8px",marginRight:"8px",cursor:"pointer",position:"relative",borderRadius:"50%",transition:"transform 0.2s ease, background-color 0.2s ease",zIndex:"1000"}),t.innerHTML=`<img src="${chrome.runtime.getURL("icons/reply_guy_logo.png")}" style="width: 20px; height: 20px;" />`,t.addEventListener("mouseenter",()=>{t.style.transform="scale(1.1)",t.style.backgroundColor="rgba(102, 126, 234, 0.1)"}),t.addEventListener("mouseleave",()=>{t.style.transform="scale(1)",t.style.backgroundColor="transparent"}),t.addEventListener("click",e=>{e.stopPropagation(),this.handleReplyGuyClick(n)});let o=null,r="";const i=e.closest('[role="group"]');if(i&&(o=i,r="role=group"),!o){let n=e.parentElement;for(;n&&n!==document.body;){if(n.querySelectorAll('[role="button"]').length>=3){o=n,r="multiple-buttons-parent";break}n=n.parentElement}}if(!o&&e.parentElement&&(o=e.parentElement,r="direct-parent"),o){if("role=group"===r){const n=Array.from(o.children).filter(e=>"button"===e.getAttribute("role")||e.querySelector('[role="button"]'));n.length>=2?o.insertBefore(t,n[1]):e.parentElement&&e.parentElement.parentElement===o?o.insertBefore(t,e.parentElement.nextSibling):o.appendChild(t)}else e.parentElement&&e.parentElement.parentElement===o?o.insertBefore(t,e.parentElement.nextSibling):o.appendChild(t);console.log(`[ReplyGuy] Button injected using strategy: ${r}`),console.log(`[ReplyGuy] Button ID: ${t.id}`),console.log("[ReplyGuy] Button visibility:",{offsetWidth:t.offsetWidth,offsetHeight:t.offsetHeight,display:window.getComputedStyle(t).display,visibility:window.getComputedStyle(t).visibility})}else console.log("[ReplyGuy] Could not find suitable container for button")}async handleReplyGuyClick(e){if(console.log("[ReplyGuy] Button clicked"),!chrome.runtime?.id)return console.error("[ReplyGuy] Extension context invalidated"),void this.showInlineError("Reply Guy extension needs to be refreshed. Please reload this page.");try{const e=await chrome.runtime.sendMessage({action:"checkAuth"});if(!e?.success||!e.data?.isAuthenticated)return console.log("[ReplyGuy] User not authenticated, prompting to login"),void(confirm("Please sign in to Reply Guy to use this feature. Would you like to sign in now?")&&chrome.runtime.sendMessage({action:"openLogin"}).catch(e=>{console.error("[ReplyGuy] Failed to open login:",e)}))}catch(e){return e instanceof Error&&e.message.includes("Extension context invalidated")?(console.error("[ReplyGuy] Extension context invalidated"),void this.showInlineError("Reply Guy extension needs to be refreshed. Please reload this page.")):void console.error("[ReplyGuy] Auth check error:",e)}const n=e.querySelector('[data-testid="tweetText"]'),t=n?.textContent?.trim()||"";if(!t)return console.error("[ReplyGuy] Could not find tweet text"),void this.showInlineError("Could not find tweet text. Please try again.");console.log("[ReplyGuy] Tweet text:",t.substring(0,50)+"...");const o=e.querySelector('[data-testid="reply"]');if(!o)return console.error("[ReplyGuy] Could not find reply button"),void this.showInlineError("Could not find reply button. Please try again.");try{o.click(),setTimeout(async()=>{const e=document.querySelector('[data-testid="tweetTextarea_0_label"]')?.parentElement;if(!e)return console.error("Could not find compose area"),void this.showInlineError("Could not find compose area. Please try clicking reply again.");let n=this.overlays.get(e);n||(n=new f(e),this.overlays.set(e,n)),n.showOptions(t,async e=>{n.showLoading();try{if(!chrome.runtime?.id)return void n.showError("Extension needs to be refreshed. Please reload this page.");const t=await chrome.runtime.sendMessage({action:"generateReply",data:e});if(console.log("[ReplyGuy] Generate reply response:",t),t.success){const e=t.data.data||t.data;console.log("[ReplyGuy] Reply data extracted:",e),e.trackingStatus?(console.log("[ReplyGuy] üìä Daily Usage Tracking Status:",{success:e.trackingStatus.success,date:e.trackingStatus.date,timezone:e.trackingStatus.timezone,error:e.trackingStatus.error||"none"}),e.trackingStatus.success||console.error("[ReplyGuy] ‚ùå Failed to track daily usage:",e.trackingStatus.error)):console.warn("[ReplyGuy] ‚ö†Ô∏è No tracking status returned from API"),n.showGeneratedReply(e.reply||"Failed to generate reply",e.memeUrl,e),chrome.runtime.sendMessage({action:"checkForCelebration"})}else n.showError(t.error||"Failed to generate reply")}catch(e){e instanceof Error&&e.message.includes("Extension context invalidated")?n.showError("Extension needs to be refreshed. Please reload this page."):n.showError("Failed to connect to Reply Guy. Please make sure you are logged in."),console.error("[ReplyGuy] Error generating reply:",e)}})},500)}catch(e){console.error("[ReplyGuy] Error in reply process:",e),this.showInlineError("An error occurred. Please try again.")}}insertSuggestion(e,n){const t=e.querySelector('[role="textbox"]');if(t){t.innerText=n;const e=new Event("input",{bubbles:!0});t.dispatchEvent(e),t.focus()}}insertGeneratedReply(e,n){const t=e.querySelector('[role="textbox"]');if(t){const e=Object.getOwnPropertyDescriptor(window.HTMLTextAreaElement.prototype,"value")?.set;if(e){e.call(t,n);const o=new Event("input",{bubbles:!0});t.dispatchEvent(o),t.focus()}else{t.innerText=n;const e=new Event("input",{bubbles:!0});t.dispatchEvent(e),t.focus()}}}}var x={};!function e(n,t,o,r){var i=!!(n.Worker&&n.Blob&&n.Promise&&n.OffscreenCanvas&&n.OffscreenCanvasRenderingContext2D&&n.HTMLCanvasElement&&n.HTMLCanvasElement.prototype.transferControlToOffscreen&&n.URL&&n.URL.createObjectURL),s="function"==typeof Path2D&&"function"==typeof DOMMatrix,l=function(){if(!n.OffscreenCanvas)return!1;var e=new OffscreenCanvas(1,1),t=e.getContext("2d");t.fillRect(0,0,1,1);var o=e.transferToImageBitmap();try{t.createPattern(o,"no-repeat")}catch(e){return!1}return!0}();function a(){}function c(e){var o=t.exports.Promise,r=void 0!==o?o:n.Promise;return"function"==typeof r?new r(e):(e(a,a),null)}var p,y,d,u,g,h,m,f,v,x,b,w=(p=l,y=new Map,{transform:function(e){if(p)return e;if(y.has(e))return y.get(e);var n=new OffscreenCanvas(e.width,e.height);return n.getContext("2d").drawImage(e,0,0),y.set(e,n),n},clear:function(){y.clear()}}),R=(g=Math.floor(1e3/60),h={},m=0,"function"==typeof requestAnimationFrame&&"function"==typeof cancelAnimationFrame?(d=function(e){var n=Math.random();return h[n]=requestAnimationFrame(function t(o){m===o||m+g-1<o?(m=o,delete h[n],e()):h[n]=requestAnimationFrame(t)}),n},u=function(e){h[e]&&cancelAnimationFrame(h[e])}):(d=function(e){return setTimeout(e,g)},u=function(e){return clearTimeout(e)}),{frame:d,cancel:u}),M=(x={},function(){if(f)return f;if(!o&&i){var n=["var CONFETTI, SIZE = {}, module = {};","("+e.toString()+")(this, module, true, SIZE);","onmessage = function(msg) {","  if (msg.data.options) {","    CONFETTI(msg.data.options).then(function () {","      if (msg.data.callback) {","        postMessage({ callback: msg.data.callback });","      }","    });","  } else if (msg.data.reset) {","    CONFETTI && CONFETTI.reset();","  } else if (msg.data.resize) {","    SIZE.width = msg.data.resize.width;","    SIZE.height = msg.data.resize.height;","  } else if (msg.data.canvas) {","    SIZE.width = msg.data.canvas.width;","    SIZE.height = msg.data.canvas.height;","    CONFETTI = module.exports.create(msg.data.canvas);","  }","}"].join("\n");try{f=new Worker(URL.createObjectURL(new Blob([n])))}catch(e){return void 0!==typeof console&&"function"==typeof console.warn&&console.warn("üéä Could not load worker",e),null}!function(e){function n(n,t){e.postMessage({options:n||{},callback:t})}e.init=function(n){var t=n.transferControlToOffscreen();e.postMessage({canvas:t},[t])},e.fire=function(t,o,r){if(v)return n(t,null),v;var i=Math.random().toString(36).slice(2);return v=c(function(o){function s(n){n.data.callback===i&&(delete x[i],e.removeEventListener("message",s),v=null,w.clear(),r(),o())}e.addEventListener("message",s),n(t,i),x[i]=s.bind(null,{data:{callback:i}})})},e.reset=function(){for(var n in e.postMessage({reset:!0}),x)x[n](),delete x[n]}}(f)}return f}),S={particleCount:50,angle:90,spread:45,startVelocity:45,decay:.9,gravity:1,drift:0,ticks:200,x:.5,y:.5,shapes:["square","circle"],zIndex:100,colors:["#26ccff","#a25afd","#ff5e7e","#88ff5a","#fcff42","#ffa62d","#ff36ff"],disableForReducedMotion:!1,scalar:1};function k(e,n,t){return function(e,n){return n?n(e):e}(e&&null!=e[n]?e[n]:S[n],t)}function E(e){return e<0?0:Math.floor(e)}function L(e,n){return Math.floor(Math.random()*(n-e))+e}function C(e){return parseInt(e,16)}function T(e){return e.map(G)}function G(e){var n=String(e).replace(/[^0-9a-f]/gi,"");return n.length<6&&(n=n[0]+n[0]+n[1]+n[1]+n[2]+n[2]),{r:C(n.substring(0,2)),g:C(n.substring(2,4)),b:C(n.substring(4,6))}}function I(e){e.width=document.documentElement.clientWidth,e.height=document.documentElement.clientHeight}function P(e){var n=e.getBoundingClientRect();e.width=n.width,e.height=n.height}function A(e){var n=e.angle*(Math.PI/180),t=e.spread*(Math.PI/180);return{x:e.x,y:e.y,wobble:10*Math.random(),wobbleSpeed:Math.min(.11,.1*Math.random()+.05),velocity:.5*e.startVelocity+Math.random()*e.startVelocity,angle2D:-n+(.5*t-Math.random()*t),tiltAngle:(.5*Math.random()+.25)*Math.PI,color:e.color,shape:e.shape,tick:0,totalTicks:e.ticks,decay:e.decay,drift:e.drift,random:Math.random()+2,tiltSin:0,tiltCos:0,wobbleX:0,wobbleY:0,gravity:3*e.gravity,ovalScalar:.6,scalar:e.scalar,flat:e.flat}}function q(e,t){var l,a=!e,p=!!k(t||{},"resize"),y=!1,d=k(t,"disableForReducedMotion",Boolean),u=i&&k(t||{},"useWorker")?M():null,g=a?I:P,h=!(!e||!u||!e.__confetti_initialized),m="function"==typeof matchMedia&&matchMedia("(prefers-reduced-motion)").matches;function f(n,t,i){for(var a=k(n,"particleCount",E),p=k(n,"angle",Number),y=k(n,"spread",Number),d=k(n,"startVelocity",Number),u=k(n,"decay",Number),h=k(n,"gravity",Number),m=k(n,"drift",Number),f=k(n,"colors",T),v=k(n,"ticks",Number),x=k(n,"shapes"),b=k(n,"scalar"),M=!!k(n,"flat"),S=function(e){var n=k(e,"origin",Object);return n.x=k(n,"x",Number),n.y=k(n,"y",Number),n}(n),C=a,G=[],I=e.width*S.x,P=e.height*S.y;C--;)G.push(A({x:I,y:P,angle:p,spread:y,startVelocity:d,color:f[C%f.length],shape:x[L(0,x.length)],ticks:v,decay:u,gravity:h,drift:m,scalar:b,flat:M}));return l?l.addFettis(G):(l=function(e,n,t,i,l){var a,p,y=n.slice(),d=e.getContext("2d"),u=c(function(n){function c(){a=p=null,d.clearRect(0,0,i.width,i.height),w.clear(),l(),n()}a=R.frame(function n(){!o||i.width===r.width&&i.height===r.height||(i.width=e.width=r.width,i.height=e.height=r.height),i.width||i.height||(t(e),i.width=e.width,i.height=e.height),d.clearRect(0,0,i.width,i.height),(y=y.filter(function(e){return function(e,n){n.x+=Math.cos(n.angle2D)*n.velocity+n.drift,n.y+=Math.sin(n.angle2D)*n.velocity+n.gravity,n.velocity*=n.decay,n.flat?(n.wobble=0,n.wobbleX=n.x+10*n.scalar,n.wobbleY=n.y+10*n.scalar,n.tiltSin=0,n.tiltCos=0,n.random=1):(n.wobble+=n.wobbleSpeed,n.wobbleX=n.x+10*n.scalar*Math.cos(n.wobble),n.wobbleY=n.y+10*n.scalar*Math.sin(n.wobble),n.tiltAngle+=.1,n.tiltSin=Math.sin(n.tiltAngle),n.tiltCos=Math.cos(n.tiltAngle),n.random=Math.random()+2);var t=n.tick++/n.totalTicks,o=n.x+n.random*n.tiltCos,r=n.y+n.random*n.tiltSin,i=n.wobbleX+n.random*n.tiltCos,l=n.wobbleY+n.random*n.tiltSin;if(e.fillStyle="rgba("+n.color.r+", "+n.color.g+", "+n.color.b+", "+(1-t)+")",e.beginPath(),s&&"path"===n.shape.type&&"string"==typeof n.shape.path&&Array.isArray(n.shape.matrix))e.fill(function(e,n,t,o,r,i,s){var l=new Path2D(e),a=new Path2D;a.addPath(l,new DOMMatrix(n));var c=new Path2D;return c.addPath(a,new DOMMatrix([Math.cos(s)*r,Math.sin(s)*r,-Math.sin(s)*i,Math.cos(s)*i,t,o])),c}(n.shape.path,n.shape.matrix,n.x,n.y,.1*Math.abs(i-o),.1*Math.abs(l-r),Math.PI/10*n.wobble));else if("bitmap"===n.shape.type){var a=Math.PI/10*n.wobble,c=.1*Math.abs(i-o),p=.1*Math.abs(l-r),y=n.shape.bitmap.width*n.scalar,d=n.shape.bitmap.height*n.scalar,u=new DOMMatrix([Math.cos(a)*c,Math.sin(a)*c,-Math.sin(a)*p,Math.cos(a)*p,n.x,n.y]);u.multiplySelf(new DOMMatrix(n.shape.matrix));var g=e.createPattern(w.transform(n.shape.bitmap),"no-repeat");g.setTransform(u),e.globalAlpha=1-t,e.fillStyle=g,e.fillRect(n.x-y/2,n.y-d/2,y,d),e.globalAlpha=1}else if("circle"===n.shape)e.ellipse?e.ellipse(n.x,n.y,Math.abs(i-o)*n.ovalScalar,Math.abs(l-r)*n.ovalScalar,Math.PI/10*n.wobble,0,2*Math.PI):function(e,n,t,o,r,i,s,l){e.save(),e.translate(n,t),e.rotate(i),e.scale(o,r),e.arc(0,0,1,0,l,void 0),e.restore()}(e,n.x,n.y,Math.abs(i-o)*n.ovalScalar,Math.abs(l-r)*n.ovalScalar,Math.PI/10*n.wobble,0,2*Math.PI);else if("star"===n.shape)for(var h=Math.PI/2*3,m=4*n.scalar,f=8*n.scalar,v=n.x,x=n.y,b=5,R=Math.PI/b;b--;)v=n.x+Math.cos(h)*f,x=n.y+Math.sin(h)*f,e.lineTo(v,x),h+=R,v=n.x+Math.cos(h)*m,x=n.y+Math.sin(h)*m,e.lineTo(v,x),h+=R;else e.moveTo(Math.floor(n.x),Math.floor(n.y)),e.lineTo(Math.floor(n.wobbleX),Math.floor(r)),e.lineTo(Math.floor(i),Math.floor(l)),e.lineTo(Math.floor(o),Math.floor(n.wobbleY));return e.closePath(),e.fill(),n.tick<n.totalTicks}(d,e)})).length?a=R.frame(n):c()}),p=c});return{addFettis:function(e){return y=y.concat(e),u},canvas:e,promise:u,reset:function(){a&&R.cancel(a),p&&p()}}}(e,G,g,t,i),l.promise)}function v(t){var o=d||k(t,"disableForReducedMotion",Boolean),r=k(t,"zIndex",Number);if(o&&m)return c(function(e){e()});a&&l?e=l.canvas:a&&!e&&(e=function(e){var n=document.createElement("canvas");return n.style.position="fixed",n.style.top="0px",n.style.left="0px",n.style.pointerEvents="none",n.style.zIndex=e,n}(r),document.body.appendChild(e)),p&&!h&&g(e);var i={width:e.width,height:e.height};function s(){if(u){var n={getBoundingClientRect:function(){if(!a)return e.getBoundingClientRect()}};return g(n),void u.postMessage({resize:{width:n.width,height:n.height}})}i.width=i.height=null}function v(){l=null,p&&(y=!1,n.removeEventListener("resize",s)),a&&e&&(document.body.contains(e)&&document.body.removeChild(e),e=null,h=!1)}return u&&!h&&u.init(e),h=!0,u&&(e.__confetti_initialized=!0),p&&!y&&(y=!0,n.addEventListener("resize",s,!1)),u?u.fire(t,i,v):f(t,i,v)}return v.reset=function(){u&&u.reset(),l&&l.reset()},v}function z(){return b||(b=q(null,{useWorker:!0,resize:!0})),b}t.exports=function(){return z().apply(this,arguments)},t.exports.reset=function(){z().reset()},t.exports.create=q,t.exports.shapeFromPath=function(e){if(!s)throw new Error("path confetti are not supported in this browser");var n,t;"string"==typeof e?n=e:(n=e.path,t=e.matrix);var o=new Path2D(n),r=document.createElement("canvas").getContext("2d");if(!t){for(var i,l,a=1e3,c=a,p=a,y=0,d=0,u=0;u<a;u+=2)for(var g=0;g<a;g+=2)r.isPointInPath(o,u,g,"nonzero")&&(c=Math.min(c,u),p=Math.min(p,g),y=Math.max(y,u),d=Math.max(d,g));i=y-c,l=d-p;var h=Math.min(10/i,10/l);t=[h,0,0,h,-Math.round(i/2+c)*h,-Math.round(l/2+p)*h]}return{type:"path",path:n,matrix:t}},t.exports.shapeFromText=function(e){var n,t=1,o="#000000",r='"Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", "Noto Color Emoji", "EmojiOne Color", "Android Emoji", "Twemoji Mozilla", "system emoji", sans-serif';"string"==typeof e?n=e:(n=e.text,t="scalar"in e?e.scalar:t,r="fontFamily"in e?e.fontFamily:r,o="color"in e?e.color:o);var i=10*t,s=i+"px "+r,l=new OffscreenCanvas(i,i),a=l.getContext("2d");a.font=s;var c=a.measureText(n),p=Math.ceil(c.actualBoundingBoxRight+c.actualBoundingBoxLeft),y=Math.ceil(c.actualBoundingBoxAscent+c.actualBoundingBoxDescent),d=c.actualBoundingBoxLeft+2,u=c.actualBoundingBoxAscent+2;p+=4,y+=4,(a=(l=new OffscreenCanvas(p,y)).getContext("2d")).font=s,a.fillStyle=o,a.fillText(n,d,u);var g=1/t;return{type:"bitmap",bitmap:l.transferToImageBitmap(),matrix:[g,0,0,g,-p*g/2,-y*g/2]}}}(function(){return"undefined"!=typeof window?window:"undefined"!=typeof self?self:this||{}}(),x,!1);const b=x.exports;x.exports.create,console.log("[ReplyGuy Content] Script loaded at:",(new Date).toISOString(),window.location.href);let w=null,R={isAuthenticated:!1};chrome.runtime.onMessage.addListener((e,n,t)=>{n.id&&n.id!==chrome.runtime.id?console.warn("[ReplyGuy Content] Rejecting message from unknown extension:",n.id):"authStateChanged"===e.action?(R=e.data,console.log("[ReplyGuy Content] Auth state changed:",R),w&&w.cleanup(),w=new v,w.initialize()):"triggerCelebration"===e.action&&function(){const e={origin:{y:.7},zIndex:9999};function n(n,t){b({...e,...t,particleCount:Math.floor(200*n)})}n(.25,{spread:26,startVelocity:55}),n(.2,{spread:60}),n(.35,{spread:100,decay:.91,scalar:.8}),n(.1,{spread:120,startVelocity:25,decay:.92,scalar:1.2}),n(.1,{spread:120,startVelocity:45})}()});let M=location.href;new MutationObserver(()=>{const e=location.href;e!==M&&(M=e,w&&w.handleUrlChange())}).observe(document,{subtree:!0,childList:!0}),async function(){console.log("[ReplyGuy Content] Initializing on:",window.location.href);try{console.log("[ReplyGuy Content] Checking authentication...");const e=await chrome.runtime.sendMessage({action:"checkAuth"});console.log("[ReplyGuy Content] Auth response:",e),e.success&&(R=e.data,console.log("[ReplyGuy Content] Auth state:",R)),console.log("[ReplyGuy Content] Initializing Twitter integration"),w=new v,w.initialize()}catch(e){console.error("[ReplyGuy Content] Initialization error:",e)}}()})();