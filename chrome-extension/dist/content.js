(()=>{"use strict";class e{constructor(e){this.overlay=null,this.handleOutsideClick=e=>{this.overlay&&!this.overlay.contains(e.target)&&this.remove()},this.container=e}show(e,t){this.remove(),this.overlay=document.createElement("div"),this.overlay.className="reply-guy-overlay",this.overlay.innerHTML=`\n      <style>\n        .reply-guy-overlay {\n          position: absolute;\n          z-index: 10000;\n          background: white;\n          border-radius: 12px;\n          box-shadow: 0 4px 24px rgba(0, 0, 0, 0.15);\n          padding: 16px;\n          max-width: 500px;\n          margin-top: 8px;\n          animation: slideIn 0.2s ease-out;\n        }\n\n        @keyframes slideIn {\n          from {\n            opacity: 0;\n            transform: translateY(-10px);\n          }\n          to {\n            opacity: 1;\n            transform: translateY(0);\n          }\n        }\n\n        .reply-guy-header {\n          display: flex;\n          align-items: center;\n          justify-content: space-between;\n          margin-bottom: 12px;\n          padding-bottom: 12px;\n          border-bottom: 1px solid #e9ecef;\n        }\n\n        .reply-guy-title {\n          display: flex;\n          align-items: center;\n          font-size: 16px;\n          font-weight: 600;\n          color: #1a1a1a;\n        }\n\n        .reply-guy-logo {\n          width: 20px;\n          height: 20px;\n          margin-right: 8px;\n          background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\n          border-radius: 4px;\n        }\n\n        .reply-guy-close {\n          width: 24px;\n          height: 24px;\n          border: none;\n          background: none;\n          cursor: pointer;\n          color: #6c757d;\n          font-size: 20px;\n          line-height: 1;\n          transition: color 0.2s;\n        }\n\n        .reply-guy-close:hover {\n          color: #1a1a1a;\n        }\n\n        .reply-guy-suggestions {\n          display: flex;\n          flex-direction: column;\n          gap: 8px;\n        }\n\n        .reply-guy-suggestion {\n          padding: 12px;\n          background: #f8f9fa;\n          border: 1px solid #e9ecef;\n          border-radius: 8px;\n          cursor: pointer;\n          transition: all 0.2s;\n          font-size: 14px;\n          line-height: 1.5;\n          color: #1a1a1a;\n        }\n\n        .reply-guy-suggestion:hover {\n          background: #e9ecef;\n          border-color: #667eea;\n          transform: translateX(4px);\n        }\n\n        .reply-guy-loading {\n          text-align: center;\n          padding: 40px;\n          color: #6c757d;\n        }\n\n        .reply-guy-spinner {\n          width: 32px;\n          height: 32px;\n          border: 3px solid #f3f3f3;\n          border-top: 3px solid #667eea;\n          border-radius: 50%;\n          animation: spin 1s linear infinite;\n          margin: 0 auto 12px;\n        }\n\n        @keyframes spin {\n          0% { transform: rotate(0deg); }\n          100% { transform: rotate(360deg); }\n        }\n      </style>\n      <div class="reply-guy-header">\n        <div class="reply-guy-title">\n          <div class="reply-guy-logo"></div>\n          Reply Suggestions\n        </div>\n        <button class="reply-guy-close" aria-label="Close">×</button>\n      </div>\n      <div class="reply-guy-suggestions">\n        ${e.map((e,t)=>`\n          <div class="reply-guy-suggestion" data-index="${t}">\n            ${this.escapeHtml(e)}\n          </div>\n        `).join("")}\n      </div>\n    `;const n=this.container.getBoundingClientRect();this.overlay.style.position="fixed",this.overlay.style.top=`${n.bottom+window.scrollY}px`,this.overlay.style.left=`${n.left}px`,this.overlay.style.width=`${n.width}px`,this.overlay.querySelector(".reply-guy-close")?.addEventListener("click",()=>this.remove()),this.overlay.querySelectorAll(".reply-guy-suggestion").forEach(n=>{n.addEventListener("click",()=>{const o=parseInt(n.getAttribute("data-index")||"0");t(e[o]),this.remove()})}),setTimeout(()=>{document.addEventListener("click",this.handleOutsideClick)},0),document.body.appendChild(this.overlay)}showLoading(){this.remove(),this.overlay=document.createElement("div"),this.overlay.className="reply-guy-overlay",this.overlay.innerHTML=`\n      <style>\n        ${this.getStyles()}\n      </style>\n      <div class="reply-guy-loading">\n        <div class="reply-guy-spinner"></div>\n        <div>Generating suggestions...</div>\n      </div>\n    `;const e=this.container.getBoundingClientRect();this.overlay.style.position="fixed",this.overlay.style.top=`${e.bottom+window.scrollY}px`,this.overlay.style.left=`${e.left}px`,document.body.appendChild(this.overlay)}showError(e){this.remove(),this.overlay=document.createElement("div"),this.overlay.className="reply-guy-overlay",this.overlay.innerHTML=`\n      <style>\n        ${this.getStyles()}\n        .reply-guy-error {\n          padding: 20px;\n          text-align: center;\n          color: #dc3545;\n        }\n      </style>\n      <div class="reply-guy-header">\n        <div class="reply-guy-title">\n          <div class="reply-guy-logo"></div>\n          Reply Guy\n        </div>\n        <button class="reply-guy-close" aria-label="Close">×</button>\n      </div>\n      <div class="reply-guy-error">\n        ${this.escapeHtml(e)}\n      </div>\n    `;const t=this.container.getBoundingClientRect();this.overlay.style.position="fixed",this.overlay.style.top=`${t.bottom+window.scrollY}px`,this.overlay.style.left=`${t.left}px`,this.overlay.querySelector(".reply-guy-close")?.addEventListener("click",()=>this.remove()),document.body.appendChild(this.overlay)}remove(){this.overlay&&(this.overlay.remove(),this.overlay=null,document.removeEventListener("click",this.handleOutsideClick))}escapeHtml(e){const t=document.createElement("div");return t.textContent=e,t.innerHTML}getStyles(){return"\n      .reply-guy-overlay {\n        position: absolute;\n        z-index: 10000;\n        background: white;\n        border-radius: 12px;\n        box-shadow: 0 4px 24px rgba(0, 0, 0, 0.15);\n        padding: 16px;\n        max-width: 500px;\n        margin-top: 8px;\n        animation: slideIn 0.2s ease-out;\n      }\n      /* ... rest of styles from show() method ... */\n    "}}class t{constructor(){this.observer=null,this.injectedButtons=new WeakMap,this.overlays=new WeakMap,this.isAuthenticated=!1}initialize(){console.log("[ReplyGuy] Initializing X integration"),console.log("[ReplyGuy] Current URL:",window.location.href),chrome.runtime.sendMessage({action:"checkAuth"}).then(e=>{e?.success&&(this.isAuthenticated=e.data.isAuthenticated,console.log("[ReplyGuy] Auth status:",this.isAuthenticated))}).catch(e=>{console.error("[ReplyGuy] Failed to check auth:",e)}),this.setupObserver(),setTimeout(()=>this.injectReplyButtons(),1e3),setTimeout(()=>this.injectReplyButtons(),3e3)}cleanup(){this.observer&&(this.observer.disconnect(),this.observer=null),this.injectedButtons=new WeakMap}handleUrlChange(){setTimeout(()=>this.injectReplyButtons(),500)}setupObserver(){let e=null;this.observer=new MutationObserver(t=>{e&&clearTimeout(e),e=setTimeout(()=>{t.some(e=>"childList"===e.type&&e.addedNodes.length>0&&Array.from(e.addedNodes).some(e=>e instanceof Element&&(e.matches("article")||e.querySelector("article"))))&&(console.log("[ReplyGuy] New tweets detected, re-injecting buttons"),this.injectReplyButtons())},500)}),this.observer.observe(document.body,{childList:!0,subtree:!0})}injectReplyButtons(){console.log("[ReplyGuy] Looking for reply buttons..."),console.log("[ReplyGuy] Current page has",document.querySelectorAll("article").length,"tweet articles");const e=this.findReplyButtons();console.log("[ReplyGuy] Found",e.length,"reply buttons"),e.forEach((e,t)=>{const n=e.closest("article");if(n&&!this.injectedButtons.has(n)){console.log(`[ReplyGuy] Injecting button ${t+1}`);const o=this.createReplyGuyIcon(e,n);o&&this.injectedButtons.set(n,o)}else n||console.log(`[ReplyGuy] No article found for reply button ${t+1}`)})}findReplyButtons(){const e=['[data-testid="reply"]','[aria-label*="Reply"]','[role="button"][aria-label*="Reply"]','div[role="button"] svg path[d*="M1.751 10c0-4.42"]'];let t=[];for(const n of e){const e=document.querySelectorAll(n);if(e.length>0){console.log(`[ReplyGuy] Found ${e.length} reply buttons with selector: ${n}`),t=Array.from(e);break}}return 0===t.length&&console.log("[ReplyGuy] No reply buttons found with any selector"),t}createReplyGuyIcon(e,t){const n=document.createElement("div");n.id=`replyguy-btn-${Date.now()}`,n.setAttribute("role","button"),n.setAttribute("data-testid","replyguy"),n.setAttribute("tabindex","0"),Object.assign(n.style,{display:"inline-flex",alignItems:"center",justifyContent:"center",width:"36px",height:"36px",marginLeft:"12px",cursor:"pointer",position:"relative",borderRadius:"50%",transition:"transform 0.2s ease",zIndex:"1000",border:"2px solid red"}),n.innerHTML='\n      <div style="\n        position: relative;\n        width: 36px;\n        height: 36px;\n        border-radius: 50%;\n        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        box-shadow: 0 2px 4px rgba(0,0,0,0.1);\n      ">\n        <svg viewBox="0 0 24 24" style="\n          width: 20px;\n          height: 20px;\n          color: white;\n          fill: white;\n        ">\n          <path d="M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.77-3.77a6 6 0 0 1-7.94 7.94l-6.91 6.91a2.12 2.12 0 0 1-3-3l6.91-6.91a6 6 0 0 1 7.94-7.94l-3.76 3.76z" fill="white"/>\n        </svg>\n      </div>\n    ',n.addEventListener("mouseenter",()=>{n.style.transform="scale(1.1)"}),n.addEventListener("mouseleave",()=>{n.style.transform="scale(1)"}),n.addEventListener("click",e=>{e.stopPropagation(),this.handleReplyGuyClick(t)});let o=null,i="";const s=e.closest('[role="group"]');if(s&&(o=s,i="role=group"),!o){let t=e.parentElement;for(;t&&t!==document.body;){if(t.querySelectorAll('[role="button"]').length>=3){o=t,i="multiple-buttons-parent";break}t=t.parentElement}}return!o&&e.parentElement&&(o=e.parentElement,i="direct-parent"),o?(e.parentElement&&e.parentElement.parentElement===o?o.insertBefore(n,e.parentElement.nextSibling):o.appendChild(n),console.log(`[ReplyGuy] Button injected using strategy: ${i}`),console.log(`[ReplyGuy] Button ID: ${n.id}`),console.log("[ReplyGuy] Button visibility:",{offsetWidth:n.offsetWidth,offsetHeight:n.offsetHeight,display:window.getComputedStyle(n).display,visibility:window.getComputedStyle(n).visibility}),n):(console.log("[ReplyGuy] Could not find suitable container for button"),null)}async handleReplyGuyClick(t){console.log("[ReplyGuy] Button clicked");const n=await chrome.runtime.sendMessage({action:"checkAuth"});if(!n?.success||!n.data.isAuthenticated)return console.log("[ReplyGuy] User not authenticated, prompting to login"),void(confirm("Please sign in to Reply Guy to use this feature. Would you like to sign in now?")&&chrome.runtime.sendMessage({action:"openLogin"}));const o=t.querySelector('[data-testid="tweetText"]'),i=o?.textContent||"";if(!i)return void console.error("[ReplyGuy] Could not find tweet text");console.log("[ReplyGuy] Tweet text:",i.substring(0,50)+"...");const s=t.querySelector('[data-testid="reply"]');s&&(s.click(),setTimeout(async()=>{const t=document.querySelector('[data-testid="tweetTextarea_0_label"]')?.parentElement;if(!t)return void console.error("Could not find compose area");let n=this.overlays.get(t);n||(n=new e(t),this.overlays.set(t,n)),n.showLoading();try{const e=await chrome.runtime.sendMessage({action:"getSuggestions",data:{tweet:i}});e.success?n.show(e.data.suggestions,e=>{this.insertSuggestion(t,e)}):n.showError(e.error||"Failed to get suggestions")}catch(e){n.showError("Failed to connect to Reply Guy. Please make sure you are logged in.")}},500))}insertSuggestion(e,t){const n=e.querySelector('[role="textbox"]');if(n){n.innerText=t;const e=new Event("input",{bubbles:!0});n.dispatchEvent(e),n.focus()}}}let n=null,o={isAuthenticated:!1};chrome.runtime.onMessage.addListener((e,i,s)=>{"authStateChanged"===e.action&&(o=e.data,o.isAuthenticated&&!n?(n=new t,n.initialize()):!o.isAuthenticated&&n&&(n.cleanup(),n=null))});let i=location.href;new MutationObserver(()=>{const e=location.href;e!==i&&(i=e,n&&n.handleUrlChange())}).observe(document,{subtree:!0,childList:!0}),async function(){console.log("[ReplyGuy Content] Initializing on:",window.location.href);try{console.log("[ReplyGuy Content] Checking authentication...");const e=await chrome.runtime.sendMessage({action:"checkAuth"});console.log("[ReplyGuy Content] Auth response:",e),e.success&&(o=e.data,console.log("[ReplyGuy Content] Auth state:",o)),o.isAuthenticated?(console.log("[ReplyGuy Content] User authenticated, initializing Twitter integration"),n=new t,n.initialize()):(console.log("[ReplyGuy Content] User not authenticated"),n=new t,n.initialize())}catch(e){console.error("[ReplyGuy Content] Initialization error:",e)}}()})();